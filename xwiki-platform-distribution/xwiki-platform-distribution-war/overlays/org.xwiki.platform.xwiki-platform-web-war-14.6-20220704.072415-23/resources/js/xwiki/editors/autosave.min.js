'use strict';var XWiki=function(d){function e(){return new f.AutoSave}var f=d.editors=d.editors||{};f.AutoSave=Class.create({options:{enabled:!1,frequency:5,showConfigurationUI:!0,disabledOpacity:.2,form:void 0},initialize:function(a){this.options=Object.extend(Object.clone(this.options),a||{});(this.form=$(this.options.form)||$("xwikieditcontent")&&$("xwikieditcontent").up("form"))&&!this.form.down("#autosaveControl")&&(this.initVersionMetadataElements(),this.options.showConfigurationUI&&(this.createUIElements(),
this.addListeners()),this.toggleTimer())},initVersionMetadataElements:function(){var a=new Element("div",{"class":"hidden"});this.editComment=this.form.down('input[name="comment"]');this.editComment||(this.editComment=new Element("input",{type:"hidden",name:"comment"}),this.customMetadataElementsContainer=a,a.insert(this.editComment));this.minorEditCheckbox=this.form.down('input[name="minorEdit"]');this.minorEditCheckbox||(this.minorEditCheckbox=new Element("input",{type:"checkbox",name:"minorEdit",
checked:!0}),this.customMetadataElementsContainer=a,a.insert(this.minorEditCheckbox))},createUIElements:function(){this.autosaveCheckbox=new Element("input",{type:"checkbox",checked:this.options.enabled,name:"doAutosave",id:"doAutosave"});this.autosaveInput=new Element("input",{type:"text",value:this.options.frequency,size:"2","class":"autosave-frequency"});var a=new Element("label",{"class":"autosave","for":"doAutosave"});a.appendChild(this.autosaveCheckbox);a.appendChild(document.createTextNode(" $services.localization.render('core.edit.autosave')"));
var b=new Element("label",{"class":"frequency"});b.appendChild(document.createTextNode("$services.localization.render('core.edit.autosave.every') "));b.appendChild(this.autosaveInput);this.timeUnit=new Element("span");this.setTimeUnit();b.appendChild(document.createTextNode(" "));b.appendChild(this.timeUnit);this.options.enabled||b.setOpacity(this.options.disabledOpacity);var c=new Element("div",{id:"autosaveControl"});c.appendChild(a);c.appendChild(document.createTextNode(" "));c.appendChild(b);
c.appendChild(document.createTextNode(" "));this.form.down(".buttons").insert(c)},addListeners:function(){var a=function(b){b.keyCode==Event.KEY_RETURN&&(b.stop(),b.element().blur())};["keydown","keyup","keypress"].each(function(b){this.autosaveInput.observe(b,a);this.autosaveCheckbox.observe(b,a)}.bind(this));Event.observe(this.autosaveCheckbox,"click",function(){this.toggleTimer(this.autosaveCheckbox.checked)}.bindAsEventListener(this));Event.observe(this.autosaveInput,"blur",function(){var b=new Number(this.autosaveInput.value);
0<b?(this.options.frequency=b,this.setTimeUnit(),this.startTimer()):this.autosaveInput.value=this.options.frequency}.bindAsEventListener(this));this._toggleTimerWhenSaveButtonIsEnabledOrDisabled()},setTimeUnit:function(){1==this.options.frequency?this.timeUnit.update("minute"):this.timeUnit.update("minutes")},_toggleTimerWhenSaveButtonIsEnabledOrDisabled:function(){var a=this,b=new MutationObserver(function(g){g.forEach(function(h){h.target.disabled?a.stopTimer():a.toggleTimer()})}),c=this.form.down('input[name="action_saveandcontinue"]');
b.observe(c,{attributes:!0,attributeFilter:["disabled"]})},toggleTimer:function(a){"boolean"===typeof a&&(this.options.enabled=a);this.options.enabled?(this.startTimer(),this.autosaveInput&&this.autosaveInput.up("label").setOpacity("1.0")):(this.stopTimer(),this.autosaveInput&&this.autosaveInput.up("label").setOpacity(this.options.disabledOpacity))},startTimer:function(){this.stopTimer();this.timer=new PeriodicalExecuter(this.doAutosave.bind(this),60*this.options.frequency)},stopTimer:function(){this.timer&&
(this.timer.stop(),delete this.timer)},doAutosave:function(){this.updateVersionMetadata();try{this.form.down('input[name="action_saveandcontinue"]').click()}finally{this.resetVersionMetadata()}},updateVersionMetadata:function(){this.customMetadataElementsContainer&&this.form.insert(this.customMetadataElementsContainer);this.userEditComment=this.editComment.value;this.userMinorEdit=this.minorEditCheckbox.checked;this.editComment.value+=" (Autosaved)";this.minorEditCheckbox.checked=!0},resetVersionMetadata:function(){this.customMetadataElementsContainer&&
this.customMetadataElementsContainer.remove();this.editComment.value=this.userEditComment;this.minorEditCheckbox.checked=this.userMinorEdit}});d.domIsLoaded&&e()||document.observe("xwiki:dom:loaded",e);return d}(XWiki||{});

//# sourceMappingURL=autosave.min.js.map
