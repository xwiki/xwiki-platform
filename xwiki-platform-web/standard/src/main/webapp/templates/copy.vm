###
### Copy document template
###
#if(!$xwiki.hasAccessLevel("edit"))
  #template("accessdenied.vm")
#elseif($doc.isNew())
  $response.setStatus(404)
  #template("startpage.vm")
  <div class="main layoutsubsection">
  <div id="mainContentArea">
    #error("$msg.get('core.rename.nonexistingDocument')")
  </div>## mainContentArea
  </div>## main
  #template("endpage.vm")
#else
  #template("startpage.vm")
  <div class="main layoutsubsection">
  <div id="mainContentArea">
    <div id="document-title"><h1>$msg.get('core.copy.copydoc')</h1></div>
    #set($sourcedoc = "$!{request.sourcedoc}")
    #set($targetdoc = "$!{request.targetdoc}")
    #if("$!request.language" != "" && "$!{request.language}" != 'ALL')
      #set($language = $request.language)
    #end
    #set($sourcewiki = $context.database)
    #set($targetwiki = $context.database)
    #if($targetdoc != "")
    #set($ok = $xwiki.copyDocument($sourcedoc, $targetdoc, $sourcewiki, $targetwiki, $language, false, true))
    #set($prefixedSourcedoc = "#if($sourcewiki!=$context.database)$sourcewiki:#end$sourcedoc")
    #set($prefixedTargetdoc = "#if($targetwiki!=$context.database)$targetwiki:#end$targetdoc")
    #if($language)
      #set($fromurl = $xwiki.getURL("$prefixedSourcedoc", "view", "language=${language}"))
      #set($tourl = $xwiki.getURL("$prefixedTargetdoc", "view", "language=${language}"))
    #else
      #set($fromurl = $xwiki.getURL("$prefixedSourcedoc"))
      #set($tourl = $xwiki.getURL("$prefixedTargetdoc"))
    #end
    #set($sourcelink = "<a href='${fromurl}'>$prefixedSourcedoc #if($language)($language)#end</a>")
    #set($targetlink = "<a href='${tourl}'>$prefixedTargetdoc</a>")
    #info("$msg.get('core.copy.copyingdoc', [$sourcelink, $targetlink])")
    #else
    <form action="">
    <div class="hidden"><input type="hidden" name="xpage" value="copy" /></div>
    <table>
    <tr><td>$msg.get("core.copy.sourcedoc"):</td>
    <td>$doc.fullName <input type="hidden" name="sourcedoc" value="$doc.fullName" size="60"/></td></tr>
    #set ($docTranslations = $doc.getTranslationList())
    #if ($docTranslations.size() > 0)
    <tr>
      <td>$msg.get("language"):</td>
      <td>
        <select name="language">
        ## Add a special "All Translations" combo box entry to copy all translations.
        <option value="ALL" selected="selected">$msg.get("core.copy.allTranslations")</option>
        ## Add all the existing translations
        #foreach ($docTranslation in $docTranslations)
          <option>$docTranslation</option>
        #end
        </select>
      </td>
    </tr>
    #end
    <tr><td><label for="targetdoc">$msg.get("core.copy.targetdoc")</label>:</td>
    <td><input type="text" id="targetdoc" name="targetdoc" value="$!{request.targetdoc}" size="60" /></td></tr>
    </table>
    <div><span class="buttonwrapper"><input type="submit" value="Copy" class="button"/></span></div>
    </form>
    #end
    <div class="clearfloats"></div>
  </div>## mainContentArea
  </div>## main
#template("endpage.vm")
#end
