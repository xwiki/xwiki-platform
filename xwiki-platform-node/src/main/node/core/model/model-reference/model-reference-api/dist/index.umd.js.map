{"version":3,"file":"index.umd.js","sources":["../src/defaultModelReferenceHandler.ts","../src/defaultModelReferenceHandlerProvider.ts","../src/defaultModelReferenceParserProvider.ts","../src/defaultModelReferenceSerializerProvider.ts","../src/componentInit.ts"],"sourcesContent":["/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport {\n  AttachmentReference,\n  DocumentReference,\n  EntityType,\n} from \"@xwiki/cristal-model-api\";\nimport { injectable } from \"inversify\";\nimport type { ModelReferenceHandler } from \"./modelReferenceHandler\";\nimport type {\n  EntityReference,\n  SpaceReference,\n  WikiReference,\n} from \"@xwiki/cristal-model-api\";\n\n/**\n * Default implementation for {@link ModelReferenceHandler}.\n *\n * @since 0.13\n * @beta\n */\n@injectable()\nclass DefaultModelReferenceHandler implements ModelReferenceHandler {\n  createDocumentReference(\n    name: string,\n    space: SpaceReference,\n  ): DocumentReference {\n    return new DocumentReference(name, space);\n  }\n\n  getTitle(reference: EntityReference): string {\n    switch (reference.type) {\n      case EntityType.WIKI:\n        return (reference as WikiReference).name;\n      case EntityType.SPACE:\n        return [...(reference as SpaceReference).names].pop()!;\n      case EntityType.DOCUMENT: {\n        return (reference as DocumentReference).name;\n      }\n      case EntityType.ATTACHMENT:\n        return (reference as AttachmentReference).name;\n    }\n    return \"\";\n  }\n}\n\nexport { DefaultModelReferenceHandler };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { inject, injectable } from \"inversify\";\nimport type { ModelReferenceHandler } from \"./modelReferenceHandler\";\nimport type { ModelReferenceHandlerProvider } from \"./modelReferenceHandlerProvider\";\nimport type { CristalApp } from \"@xwiki/cristal-api\";\n\n/**\n * Default implementation for {@link ModelReferenceHandlerProvider}.\n * Will provide an instance of\n * {@link ./defaultModelReferenceHandler#DefaultModelReferenceHandler} as a\n * fallback if no better fit was registered.\n *\n * @since 0.13\n * @beta\n */\n@injectable()\nclass DefaultModelReferenceHandlerProvider\n  implements ModelReferenceHandlerProvider\n{\n  constructor(@inject(\"CristalApp\") private cristalApp: CristalApp) {}\n\n  get(type?: string): ModelReferenceHandler | undefined {\n    const container = this.cristalApp.getContainer();\n    const resolvedType = type || this.cristalApp.getWikiConfig().getType();\n    // If there is no specific ModelReferenceHandler registered for the\n    // requested type, we return an instance of DefaultModelReferenceHandler\n    // (which should be the only unnamed one).\n    if (container.isBound(\"ModelReferenceHandler\", { name: resolvedType })) {\n      return container.get(\"ModelReferenceHandler\", { name: resolvedType });\n    } else {\n      return container.get(\"ModelReferenceHandler\");\n    }\n  }\n}\n\nexport { DefaultModelReferenceHandlerProvider };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { inject, injectable } from \"inversify\";\nimport type { ModelReferenceParser } from \"./modelReferenceParser\";\nimport type { ModelReferenceParserProvider } from \"./modelReferenceParserProvider\";\nimport type { CristalApp } from \"@xwiki/cristal-api\";\n\n/**\n * @since 0.12\n * @beta\n */\n@injectable()\nclass DefaultModelReferenceParserProvider\n  implements ModelReferenceParserProvider\n{\n  constructor(@inject(\"CristalApp\") private readonly cristalApp: CristalApp) {}\n\n  get(type?: string): ModelReferenceParser | undefined {\n    const resolvedType = type || this.cristalApp.getWikiConfig().getType();\n    try {\n      return this.cristalApp\n        .getContainer()\n        .get(\"ModelReferenceParser\", { name: resolvedType });\n    } catch (e) {\n      this.cristalApp\n        .getLogger(\"model-reference.api\")\n        .warn(\n          `Couldn't resolve ModelReferenceParser for type=[${resolvedType}]`,\n          e,\n        );\n      return undefined;\n    }\n  }\n}\n\nexport { DefaultModelReferenceParserProvider };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { inject, injectable } from \"inversify\";\nimport type { ModelReferenceSerializer } from \"./modelReferenceSerializer\";\nimport type { ModelReferenceSerializerProvider } from \"./modelReferenceSerializerProvider\";\nimport type { CristalApp } from \"@xwiki/cristal-api\";\n\n/**\n * @since 0.12\n * @beta\n */\n@injectable()\nclass DefaultModelReferenceSerializerProvider\n  implements ModelReferenceSerializerProvider\n{\n  constructor(@inject(\"CristalApp\") private readonly cristalApp: CristalApp) {}\n\n  get(type?: string): ModelReferenceSerializer | undefined {\n    const resolvedType = type || this.cristalApp.getWikiConfig().getType();\n    try {\n      return this.cristalApp\n        .getContainer()\n        .get(\"ModelReferenceSerializer\", { name: resolvedType });\n    } catch (e) {\n      this.cristalApp\n        .getLogger(\"model-reference.api\")\n        .warn(\n          `Couldn't resolve ModelReferenceSerializer for type=[${resolvedType}]`,\n          e,\n        );\n      return undefined;\n    }\n  }\n}\n\nexport { DefaultModelReferenceSerializerProvider };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { DefaultModelReferenceHandler } from \"./defaultModelReferenceHandler\";\nimport { DefaultModelReferenceHandlerProvider } from \"./defaultModelReferenceHandlerProvider\";\nimport { DefaultModelReferenceParserProvider } from \"./defaultModelReferenceParserProvider\";\nimport { DefaultModelReferenceSerializerProvider } from \"./defaultModelReferenceSerializerProvider\";\nimport type { ModelReferenceHandler } from \"./modelReferenceHandler\";\nimport type { ModelReferenceHandlerProvider } from \"./modelReferenceHandlerProvider\";\nimport type { ModelReferenceParserProvider } from \"./modelReferenceParserProvider\";\nimport type { ModelReferenceSerializerProvider } from \"./modelReferenceSerializerProvider\";\nimport type { Container } from \"inversify\";\n\n/**\n * @beta\n */\nclass ComponentInit {\n  constructor(container: Container) {\n    container\n      .bind<ModelReferenceHandler>(\"ModelReferenceHandler\")\n      .to(DefaultModelReferenceHandler)\n      .inSingletonScope()\n      .whenDefault();\n    container\n      .bind<ModelReferenceHandlerProvider>(\"ModelReferenceHandlerProvider\")\n      .to(DefaultModelReferenceHandlerProvider)\n      .inSingletonScope();\n    container\n      .bind<ModelReferenceParserProvider>(\"ModelReferenceParserProvider\")\n      .to(DefaultModelReferenceParserProvider)\n      .inSingletonScope();\n    container\n      .bind<ModelReferenceSerializerProvider>(\n        \"ModelReferenceSerializerProvider\",\n      )\n      .to(DefaultModelReferenceSerializerProvider)\n      .inSingletonScope();\n  }\n}\n\nexport { ComponentInit };\n"],"names":["DefaultModelReferenceHandler","name","space","DocumentReference","reference","EntityType","__decorateClass","injectable","DefaultModelReferenceHandlerProvider","cristalApp","type","container","resolvedType","__decorateParam","DefaultModelReferenceParserProvider","e","DefaultModelReferenceSerializerProvider","ComponentInit"],"mappings":"ogBAwCA,IAAMA,EAAN,KAAoE,CAClE,wBACEC,EACAC,EACmB,CACnB,OAAO,IAAIC,EAAAA,kBAAkBF,EAAMC,CAAK,CAC1C,CAEA,SAASE,EAAoC,CAC3C,OAAQA,EAAU,KAAA,CAChB,KAAKC,EAAAA,WAAW,KACd,OAAQD,EAA4B,KACtC,KAAKC,EAAAA,WAAW,MACd,MAAO,CAAC,GAAID,EAA6B,KAAK,EAAE,IAAA,EAClD,KAAKC,EAAAA,WAAW,SACd,OAAQD,EAAgC,KAE1C,KAAKC,EAAAA,WAAW,WACd,OAAQD,EAAkC,IAAA,CAE9C,MAAO,EACT,CACF,EAtBMJ,EAANM,EAAA,CADCC,EAAAA,WAAA,CAAW,EACNP,CAAA,uKCLN,IAAMQ,EAAN,KAEA,CACE,YAA0CC,EAAwB,CAAxB,KAAA,WAAAA,CAAyB,CAEnE,IAAIC,EAAkD,CACpD,MAAMC,EAAY,KAAK,WAAW,aAAA,EAC5BC,EAAeF,GAAQ,KAAK,WAAW,cAAA,EAAgB,QAAA,EAI7D,OAAIC,EAAU,QAAQ,wBAAyB,CAAE,KAAMC,CAAA,CAAc,EAC5DD,EAAU,IAAI,wBAAyB,CAAE,KAAMC,EAAc,EAE7DD,EAAU,IAAI,uBAAuB,CAEhD,CACF,EAjBMH,EAANF,EAAA,CADCC,aAAA,EAIcM,aAAO,YAAY,CAAA,CAAA,EAH5BL,CAAA,uKCLN,IAAMM,EAAN,KAEA,CACE,YAAmDL,EAAwB,CAAxB,KAAA,WAAAA,CAAyB,CAE5E,IAAIC,EAAiD,CACnD,MAAME,EAAeF,GAAQ,KAAK,WAAW,cAAA,EAAgB,QAAA,EAC7D,GAAI,CACF,OAAO,KAAK,WACT,aAAA,EACA,IAAI,uBAAwB,CAAE,KAAME,EAAc,CACvD,OAASG,EAAG,CACV,KAAK,WACF,UAAU,qBAAqB,EAC/B,KACC,mDAAmDH,CAAY,IAC/DG,CAAA,EAEJ,MACF,CACF,CACF,EArBMD,EAANR,EAAA,CADCC,aAAA,EAIcM,aAAO,YAAY,CAAA,CAAA,EAH5BC,CAAA,uKCAN,IAAME,EAAN,KAEA,CACE,YAAmDP,EAAwB,CAAxB,KAAA,WAAAA,CAAyB,CAE5E,IAAIC,EAAqD,CACvD,MAAME,EAAeF,GAAQ,KAAK,WAAW,cAAA,EAAgB,QAAA,EAC7D,GAAI,CACF,OAAO,KAAK,WACT,aAAA,EACA,IAAI,2BAA4B,CAAE,KAAME,EAAc,CAC3D,OAASG,EAAG,CACV,KAAK,WACF,UAAU,qBAAqB,EAC/B,KACC,uDAAuDH,CAAY,IACnEG,CAAA,EAEJ,MACF,CACF,CACF,EArBMC,EAANV,EAAA,CADCC,aAAA,EAIcM,aAAO,YAAY,CAAA,CAAA,EAH5BG,CAAA,ECGN,MAAMC,CAAc,CAClB,YAAYN,EAAsB,CAChCA,EACG,KAA4B,uBAAuB,EACnD,GAAGX,CAA4B,EAC/B,iBAAA,EACA,YAAA,EACHW,EACG,KAAoC,+BAA+B,EACnE,GAAGH,CAAoC,EACvC,iBAAA,EACHG,EACG,KAAmC,8BAA8B,EACjE,GAAGG,CAAmC,EACtC,iBAAA,EACHH,EACG,KACC,kCAAA,EAED,GAAGK,CAAuC,EAC1C,iBAAA,CACL,CACF"}