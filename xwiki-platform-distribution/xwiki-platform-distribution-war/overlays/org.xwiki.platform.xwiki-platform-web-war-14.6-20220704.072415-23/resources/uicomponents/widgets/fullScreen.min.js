'use strict';var XWiki=function(g){function k(){return new l.FullScreen}var l=g.widgets=g.widgets||{};l.FullScreen=Class.create({margin:0,buttonSize:16,editFullScreenLabel:$jsontool.serialize($services.localization.render("core.editors.fullscreen.editFullScreen")),exitFullScreenLabel:$jsontool.serialize($services.localization.render("core.editors.fullscreen.exitFullScreen")),initialize:function(){this.buttons=$(document.body).down(".bottombuttons");this.buttons||(this.buttons=(new Element("div",{"class":"bottombuttons"})).update(new Element("div",
{"class":"buttons"})),this.buttons._x_isCustom=!0,document.body.appendChild(this.buttons.hide()));this.buttonsPlaceholder=new Element("span");this.toolbarPlaceholder=new Element("span");this.createCloseButtons();$$("textarea",".maximizable").each(function(c){this.addBehavior(c)}.bind(this));document.observe("xwiki:dom:updated",function(c){c.memo.elements.each(function(d){d.select("textarea",".maximizable").each(function(f){this.addBehavior(f)}.bind(this))}.bind(this))}.bind(this));if((this.maximizedReference=
$(document.body).down("input[name='x-maximized']"))&&""!=this.maximizedReference.value){var a=$$(this.maximizedReference.value);a&&0<a.length&&this.makeFullScreen(a[0])}this.unloadHandler=this.cleanup.bind(this);Event.observe(window,"unload",this.unloadHandler)},addBehavior:function(a){this.isNotMaximizable(a)||(this.isWikiContent(a)?this.addWikiContentButton(a):this.isWikiField(a)?this.addWikiFieldButton(a):this.addElementButton(a))},isNotMaximizable:function(a){return a.hasClassName("not-maximizable")},
isWikiContent:function(a){return"content"==a.name&&a.visible()},isWikiField:function(a){return a.visible()},addWikiContentButton:function(a){a._toolbar=$(document.body).down(".leftmenu2");a._toolbar?a._toolbar.insert({top:this.createOpenButton(a)}):this.addWikiFieldButton(a)},addElementButton:function(a){Element.insert(a,{before:this.createOpenLink(a)})},addWikiFieldButton:function(a){Element.insert(a,{before:this.createOpenLink(a)})},createOpenButton:function(a){var c=new Element("img",{"class":"fullScreenEditButton",
title:this.editFullScreenLabel,alt:this.editFullScreenLabel,src:$jsontool.serialize($xwiki.getSkinFile("icons/silk/arrow_out.png"))});c.observe("click",this.makeFullScreen.bind(this,a));c.observe("mousedown",this.preventDrag.bindAsEventListener(this));a._x_fullScreenActivator=c;c._x_maximizedElement=a;return c},createOpenLink:function(a){var c=new Element("div",{"class":"fullScreenEditLinkContainer"}),d=(new Element("a",{"class":"fullScreenEditLink",title:this.editFullScreenLabel})).update(this.editFullScreenLabel+
" &raquo;");d.observe("click",this.makeFullScreen.bind(this,a));c.update(d);a._x_fullScreenActivator=d;d._x_maximizedElement=a;return c},createCloseButtons:function(){this.closeButton=new Element("img",{"class":"fullScreenCloseButton",title:this.exitFullScreenLabel,alt:this.exitFullScreenLabel,src:$jsontool.serialize($xwiki.getSkinFile("icons/silk/arrow_in.png"))});this.closeButton.observe("click",this.closeFullScreen.bind(this));this.closeButton.observe("mousedown",this.preventDrag.bindAsEventListener(this));
this.closeButton.hide();this.actionCloseButton=new Element("input",{type:"button","class":"button",value:this.exitFullScreenLabel});this.actionCloseButtonWrapper=new Element("span",{"class":"buttonwrapper"});this.actionCloseButtonWrapper.update(this.actionCloseButton);this.actionCloseButton.observe("click",this.closeFullScreen.bind(this));this.actionCloseButtonWrapper.hide();this.buttons.down(".buttons").insert({top:this.actionCloseButtonWrapper})},makeFullScreen:function(a){document.fire("xwiki:fullscreen:enter",
{target:a});this.maximizedReference&&(a.id?this.maximizedReference.value=a.tagName+"[id='"+a.id+"']":a.name?this.maximizedReference.value=a.tagName+"[name='"+a.name+"']":a.className&&(this.maximizedReference.value=a.tagName+"."+a.className));this.maximized=a;if("function"==typeof a.setSelectionRange)var c=a.selectionStart,d=a.selectionEnd,f=a.scrollTop;a._originalStyle={width:a.style.width,height:a.style.height};var b=a.up();b.addClassName("fullScreenWrapper");a._toolbar&&(a._toolbar.hasClassName("leftmenu2")&&
b.insert({top:a._toolbar.replace(this.toolbarPlaceholder)}),a._x_fullScreenActivator.replace(this.closeButton));b.insert(this.buttons.replace(this.buttonsPlaceholder).show());b=a.up();for(a._x_fullScreenActivator.hide();b!=document.body;)b._originalStyle={overflow:b.style.overflow,position:b.style.position,width:b.style.width,height:b.style.height,left:b.style.left,right:b.style.right,top:b.style.top,bottom:b.style.bottom,padding:b.style.padding,margin:b.style.margin},b.setStyle({overflow:"visible",
position:"absolute",width:"100%",height:"100%",left:0,top:0,right:0,bottom:0,padding:0,margin:0}),b.siblings().each(function(e){e._originalDisplay=e.style.display;e.setStyle({display:"none"});e._fullscreenHidden=!0}),b=b.up();document.body._originalStyle={overflow:b.style.overflow,width:b.style.width,height:b.style.height};b=$(document.body).up();b._originalStyle={overflow:b.style.overflow,width:b.style.width,height:b.style.height};$(document.body).setStyle({overflow:"hidden",width:"100%",height:"100%"});
b.setStyle({overflow:"hidden",width:"100%",height:"100%"});this.resizeListener=this.resizeTextArea.bind(this,a);Event.observe(window,"resize",this.resizeListener);this.closeButton.show();this.actionCloseButtonWrapper.show();this.resizeTextArea(a);"function"==typeof a.setSelectionRange&&(a.scrollTop=f,a.selectionStart=c,a.selectionEnd=d);document.fire("xwiki:fullscreen:entered",{target:a})},closeFullScreen:function(){var a=this.maximized;document.fire("xwiki:fullscreen:exit",{target:a});if("function"==
typeof a.setSelectionRange)var c=a.selectionStart,d=a.selectionEnd,f=a.scrollTop;this.closeButton.hide();this.actionCloseButtonWrapper.hide();Event.stopObserving(window,"resize",this.resizeListener);a.up().removeClassName("fullScreenWrapper");for(var b=a.up(),e=[];b!=document.body;)e.push(b),b=b.up();for(var m=e.length;m--;)b=e[m],b.setStyle(b._originalStyle),b.siblings().each(function(h){h._fullscreenHidden&&(h.style.display=h._originalDisplay)});document.body.setStyle(document.body._originalStyle);
$(document.body).up().setStyle($(document.body).up()._originalStyle);this.buttonsPlaceholder.replace(this.buttons);this.buttons._x_isCustom&&this.buttons.hide();a._toolbar&&(a._toolbar.hasClassName("leftmenu2")&&this.toolbarPlaceholder.replace(a._toolbar),this.closeButton.replace(a._x_fullScreenActivator));a._x_fullScreenActivator.show();a.setStyle(a._originalStyle);delete this.maximized;this.maximizedReference&&(this.maximizedReference.value="");"function"==typeof a.setSelectionRange&&(a.scrollTop=
f,a.selectionStart=c,a.selectionEnd=d);document.fire("xwiki:fullscreen:exited",{target:a})},resizeTextArea:function(a){if(this.maximized){var c=document.viewport.getHeight(),d=document.viewport.getWidth();d-=this.margin;c=c-a.positionedOffset().top-this.margin-this.buttons.getHeight();a.setStyle({width:d+"px",height:c+"px"});document.fire("xwiki:fullscreen:resized",{target:a})}},preventDrag:function(a){a.stop()},cleanup:function(){Event.stopObserving(window,"unload",this.unloadHandler);try{this.actionCloseButtonWrapper.remove()}catch(a){}}});
g.domIsLoaded&&k()||document.observe("xwiki:dom:loaded",k);return g}(XWiki||{});

//# sourceMappingURL=fullScreen.min.js.map
