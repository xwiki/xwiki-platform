## ---------------------------------------------------------------------------
## See the NOTICE file distributed with this work for additional
## information regarding copyright ownership.
##
## This is free software; you can redistribute it and/or modify it
## under the terms of the GNU Lesser General Public License as
## published by the Free Software Foundation; either version 2.1 of
## the License, or (at your option) any later version.
##
## This software is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
## Lesser General Public License for more details.
##
## You should have received a copy of the GNU Lesser General Public
## License along with this software; if not, write to the Free
## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
## 02110-1301 USA, or see the FSF site: http://www.fsf.org.
## ---------------------------------------------------------------------------
#template('display_macros.vm')
$xwiki.jsfx.use('js/xwiki/viewers/information.js', {'forceSkinAction': true, 'language': ${xcontext.locale}})
$xwiki.ssfx.use('js/xwiki/viewers/information.css', true)
$xwiki.jsfx.use('uicomponents/edit/editableProperty.js', {'forceSkinAction': true, 'language': $xcontext.locale})
###
### Display document information
###
<div id="informationcontent" class="xwikiintracontent">
  <div id="_information" class="row xform">
    ##------------
    ## Left Column
    ##------------
    <div id="informationleft" class="col-xs-12 col-sm-6">
      <dl>
        ##
        ## Locale
        ##
        <dt#if ($hasEdit && $tdoc.realLocale == $doc.realLocale && $xwiki.isMultiLingual()) class="editableProperty"
            data-property="defaultLocale"#end>
          <label>$escapetool.xml($services.localization.render('core.viewers.information.locale'))</label>
        </dt>
        #set ($displayParams = {'value': $tdoc.realLocale})
        <dd>#displayProperty_locale($displayParams)</dd>
        ##
        ## Original Locale
        ##
        #if ($tdoc.realLocale != $doc.realLocale)
          <dt>
            <label>$escapetool.xml($services.localization.render('core.viewers.information.originalLocale'))</label>
          </dt>
          #set ($originalLocaleName = $doc.realLocale.getDisplayName($xcontext.locale))
          #set ($styleName = '')
          #if ("$!originalLocaleName" == '')
            #set ($originalLocaleName = $services.localization.render('core.viewers.information.noLocale'))
            #set ($styleName = 'text-muted')
          #end
          #set ($originalLocaleURL = $doc.getURL('view', $escapetool.url({
            'language': $doc.realLocale
          })))
          <dd class="$styleName">
            <a href="$originalLocaleURL">$escapetool.xml($originalLocaleName)</a>
          </dd>
        #end
        ##
        ## Translations
        ##
        #set ($existingTranslations = $doc.translationList)
        ## Show the list of translations if multilingual is on and either the original page is translatable (has a
        ## locale specified) or it has existing translations.
        #if ($xwiki.isMultiLingual() && ("$!doc.realLocale" != '' || !$existingTranslations.isEmpty()))
          #set ($supportedLocalesArray = $xwiki.getXWikiPreference('languages').split('\s*[|, ]\s*'))
          #set ($supportedLocales = [])
          #set ($discard = $supportedLocales.addAll($supportedLocalesArray.subList(0, $supportedLocalesArray.size())))
          ## Remove the translations that we already display above.
          #set ($discard = $supportedLocales.remove($tdoc.realLocale.toString()))
          #set ($discard = $supportedLocales.remove($doc.realLocale.toString()))
          #if (!$supportedLocales.isEmpty())
            <dt>
              <label>$escapetool.xml($services.localization.render('core.viewers.information.translations'))</label>
            </dt>
            #set ($output = [])
            #foreach ($supportedLocale in $supportedLocales)
              #set ($supportedLocaleName = $services.localization.toLocale($supportedLocale).getDisplayName(
                $xcontext.locale))
              #if ($existingTranslations.contains($supportedLocale))
                ## Link to view the existing translation.
                #set ($supportedLocaleURL = $doc.getURL('view', $escapetool.url({
                  'language': $supportedLocale
                })))
                #set ($discard = $output.add("<a href='$supportedLocaleURL'>$escapetool.xml($supportedLocaleName)</a>"))
              #else
                ## Link to create the missing translation.
                #set ($action = 'view')
                #if ($hasEdit)
                  #set ($action = 'edit')
                #end
                #set ($supportedLocaleURL = $doc.getURL($action, $escapetool.url({
                  'language': $supportedLocale
                })))
                #set ($discard = $output.add("<span class='wikicreatelink'><a href='$supportedLocaleURL'>" +
                  "$escapetool.xml($supportedLocaleName)</a></span>"))
              #end
            #end
            <dd>$stringtool.join($output, ', ')</dd>
          #end
        #end
        ##
        ## Syntax
        ##
        <dt#if ($hasEdit) class="editableProperty"#end data-property="syntax">
          <label>$escapetool.xml($services.localization.render('core.viewers.information.syntax'))</label>
        </dt>
        <dd>#displayDocumentProperty_syntax()</dd>
        ##
        ## Hidden
        ##
        <dt#if ($hasEdit) class="editableProperty"#end data-property="hidden">
          <label>$escapetool.xml($services.localization.render('core.viewers.information.hidden'))</label>
        </dt>
        <dd>#displayDocumentProperty_hidden()</dd>
      </dl>
    </div>
    ##-------------
    ## Right Column
    ##-------------
    <div id="informationright" class="col-xs-12 col-sm-6">
      <dl>
        ##
        ## Included Pages
        ##
        <dt>
          <label>$escapetool.xml($services.localization.render('core.viewers.information.includedPages'))</label>
        </dt>
        <dd>
          #set ($includedPages = $tdoc.includedPages)
          #if ($includedPages.isEmpty())
            <span class="noitems">
              $escapetool.xml($services.localization.render('core.viewers.information.noIncludedPages'))
            </span>
          #else
            #displayDocumentList($includedPages false $blacklistedSpaces)
          #end
        </dd>
        ##
        ## Backlinks
        ##
        <dt>
          <label>$escapetool.xml($services.localization.render('core.viewers.information.backlinks'))</label>
        </dt>
        <dd>
          #set ($backlinks = $doc.backlinks)
          #set ($discard = $collectiontool.sortModifiable($backlinks))
          #if ($backlinks.isEmpty())
            <span class="noitems">
              $escapetool.xml($services.localization.render('core.viewers.information.noBacklinks'))
            </span>
          #else
            #displayDocumentList($backlinks false $blacklistedSpaces)
          #end
        </dd>
        ##
        ## Reference
        ##
        <dt>
          <label>$escapetool.xml($services.localization.render('core.viewers.information.pageReference'))</label>
        </dt>
        <dd id="information-reference">
          <div class="reference-group input-group flat-buttons">
            #set ($globalHint = $services.localization.render('core.viewers.information.pageReference.globalButton'))
            <span class="input-group-btn">
              <button id="button-inout" class="btn btn-default" type="button" title="$escapetool.xml($globalHint)">
                $services.icon.renderHTML('world')
              </button>
            </span>
            <input id="reference-value" type="text" readonly title="$escapetool.xml($services.localization.render(
              'core.viewers.information.pageReference.tips'))" value="$escapetool.xml($services.model.serialize(
              $doc.getDocumentReference().getLocalDocumentReference(), 'local'))" />
            #set ($copyHint = $services.localization.render('core.viewers.information.pageReference.copyButton'))
            <span class="input-group-btn">
              <button id="button-paste" class="btn btn-default" type="button" title="$escapetool.xml($copyHint)">
                $services.icon.renderHTML('paste')
              </button>
            </span>
          </div>
        </dd>
      </dl>
    </div>
    <div class="clearfloats">&nbsp;</div>
  </div>## _information
</div>## informationcontent
