'use strict';var XWiki=function(d){function e(a){(a&&a.memo.elements||[$("body")]).forEach(function(b){(b.hasClassName("gallery")?[b]:b.select(".gallery")).forEach(function(c){new d.Gallery(c)})})}d.Gallery=Class.create({initialize:function(a){this.images=this._collectImages(a);this.container=a.update('<input type="text" tabindex="-1" class="focusCatcher"/><img class="currentImage" alt="${escapetool.xml($services.localization.render("core.widgets.gallery.currentImage"))}"/><div class="previous" title="${escapetool.xml($services.localization.render("core.widgets.gallery.previousImage"))}">&lt;</div><div class="next" title="${escapetool.xml($services.localization.render("core.widgets.gallery.nextImage"))}">&gt;</div><div class="index">0 / 0</div><div class="maximize" title="${escapetool.xml($services.localization.render("core.widgets.gallery.maximize"))}"></div>');
this.container.addClassName("xGallery");this.focusCatcher=this.container.down(".focusCatcher");this.focusCatcher.observe("keydown",this._onKeyDown.bindAsEventListener(this));this.container.observe("click",function(){this.focusCatcher.focus()}.bind(this));this.container.down(".previous").observe("click",this._onPreviousImage.bind(this));this.container.down(".next").observe("click",this._onNextImage.bind(this));this.currentImage=this.container.down(".currentImage");this.currentImage.observe("load",
this._onLoadImage.bind(this));this.currentImage.observe("error",this._onErrorImage.bind(this));this.currentImage.observe("abort",this._onAbortImage.bind(this));this.indexDisplay=this.container.down(".index");this.maximizeToggle=this.container.down(".maximize");this.maximizeToggle.observe("click",this._onToggleMaximize.bind(this));this.show(0)},_collectImages:function(a){var b=[];a=a.select("img");for(var c=0;c<a.length;c++){var f=a[c];b.push({url:f.getAttribute("src"),title:f.title});f.removeAttribute("src")}return b},
_onPreviousImage:function(){this.show(0<this.index?this.index-1:this.images.length-1)},_onNextImage:function(){this.show(this.index<this.images.length-1?this.index+1:0)},_onLoadImage:function(){Element.removeClassName(this.currentImage.parentNode,"loading");this.currentImage.style.visibility="visible"},_onErrorImage:function(){},_onAbortImage:function(){},_onKeyDown:function(a){var b=!0;switch(a.keyCode){case Event.KEY_LEFT:this._onPreviousImage();break;case Event.KEY_RIGHT:this._onNextImage();break;
case Event.KEY_HOME:this.show(0);break;case Event.KEY_END:this.show(this.images.length-1);break;case Event.KEY_ESC:this.container.hasClassName("maximized")&&this._onToggleMaximize();break;case 70:this._onToggleMaximize();break;default:b=!1}b&&Event.stop(a)},_onToggleMaximize:function(){this.maximizeToggle.toggleClassName("maximize");this.maximizeToggle.toggleClassName("minimize");this.maximizeToggle.title=this.maximizeToggle.hasClassName("maximize")?"${escapetool.javascript($services.localization.render('core.widgets.gallery.maximize'))}":
"${escapetool.javascript($services.localization.render('core.widgets.gallery.minimize'))}";this.container.toggleClassName("maximized");$(document.documentElement).toggleClassName("maximized")},show:function(a){0>a||a>=this.images.length||a==this.index||(this.currentImage.src!=this.images[a].url&&(this.currentImage.style.visibility="hidden",Element.addClassName(this.currentImage.parentNode,"loading"),this.currentImage.title=this.images[a].title,this.currentImage.src=this.images[a].url),this.index=
a,this.indexDisplay.update(a+1+" / "+this.images.length))}});d.isInitialized&&e()||document.observe("xwiki:dom:loading",e);document.observe("xwiki:dom:updated",e);return d}(XWiki||{});

//# sourceMappingURL=gallery.min.js.map
