'use strict';define("xwiki-job-messages",{prefix:"job.question.notification.",keys:["answering","canceling"]});
require(["jquery","xwiki-meta","xwiki-job-runner","xwiki-l10n!xwiki-job-messages"],function(f,p,q,h){var r=function(a){var b=f(this);b.html(a);b.trigger("job:question:loaded")},t=function(a,b){var c=b.log.items||[],d=a.find(".log");0===b.log.offset&&d.html("");d.find(".log-item-loading").removeClass("log-item-loading");f.each(c,function(e,g){var k=["log-item","log-item-"+g.level];"FINISHED"!==b.state&&e===c.length-1&&k.push("log-item-loading");f(document.createElement("li")).addClass(k.join(" ")).html(g.renderedMessage).appendTo(d)})},
l=function(a,b){return"function"===typeof a?a.bind(b)():a},v=function(a,b){var c={},d=a.data("job-answer-properties");d?m(c,l(d,a)):u(c,a,b);(b=a.data("job-answer-properties-extra"))&&m(c,l(b,a));return c},m=function(a,b){f.each(b,function(c,d){a["qproperty_"+c]=d})},u=function(a,b,c){b=b.serializeArray();c&&!c.prop("disabled")&&""!==c.attr("name")&&b.push({name:c.attr("name"),value:c.val()});b.each(function(d){var e=a[d.name];e?Array.isArray(e)?e.push(d.value):e=[e,d.value]:e=d.value;a[d.name]=e})},
n=function(a){a.preventDefault();a=f(this);var b=a.parents(".form-question");b.find("btAnswerConfirm").prop("disabled",!0);b.find("btAnswerCancel").prop("disabled",!0);if(b.length){var c=b.parents(".ui-question");if(c.length&&(c=c.data("answerCallback"),"function"===typeof c)){var d=b.data("job-answer-createRequest");if(d)c(d);else{b=v(b,a);d=h.answering;a.hasClass("btAnswerCancel")&&(b.cancel="true",d=h.canceling);var e=new XWiki.widgets.Notification(d,"inprogress");c(b).then(()=>e.hide())}}}},w=
function(a,b){var c=f(this);c.find(".ui-progress-background").toggle("NONE"!==a.state);c.find(".ui-progress-message").toggle("NONE"===a.state);"NONE"!==a.state?c.find("#state-none-hint").remove():c.find("#state-none-hint").removeClass("hidden");var d=Math.floor(100*(a.progress.offset||0));c.find(".ui-progress-bar").css("width",d+"%");d=a.log.items||[];d.length&&c.find(".ui-progress-message").html(d[d.length-1].renderedMessage);d=c.find(".ui-question");if("function"===typeof b){var e=XWiki.contextPath+
"/job/wiki/"+p.wiki+"/question/"+a.id.join("/");d.data("answerCallback",b);f.get(e).then(r.bind(d))}else d.empty();t(c,a)},x=function(a){f(this).find(".ui-progress").replaceWith(a.message)},y=function(){};f(".job-status").has(".ui-progress").each(function(){var a=f(this),b=a.attr("data-url");if(""!==b){var c=a.find(".log"),d={createStatusRequest:function(){return{url:b,data:{logOffset:c.find(".log-item").length}}}};a=a.find(".ui-question");a.length&&(a.on("click",".btAnswerConfirm",n),a.on("click",
".btAnswerCancel",n),d.createAnswerRequest=function(e,g){return"function"===typeof g?g():{url:XWiki.contextPath+"/job/question/"+e.join("/"),data:g}});(new q(d)).resume().progress(w.bind(this)).then(x.bind(this),y.bind(this))}})});

//# sourceMappingURL=job.min.js.map
