'use strict';var XWiki=function(b){var c=function(a){return a?"string"==typeof a?(a=b.Model.resolve(a,b.EntityType.DOCUMENT),new b.Document(a)):a:b.currentDocument};b.DocumentLock=Class.create({initialize:function(a){this._document=c(a);a=this.unlock.bind(this);Event.observe(window,"unload",a);Event.observe(window,"pagehide",a);$("tmLogout")&&$("tmLogout").down("a")&&$("tmLogout").down("a").observe("click",a);var e=this.setLocked.bind(this,!1);$$("form.withLock").each(function(f){f.observe("submit",
e)});b.DocumentLock._instances[b.Model.serialize(this._document.documentReference)]=this},lock:function(){this._locked||(this._locked=!0,new Ajax.Request(this._getURL("lock"),{method:"get"}))},unlock:function(){this._locked&&(this._locked=!1,navigator.sendBeacon(this._getURL("cancel")))},setLocked:function(a){this._locked=!!a},isLocked:function(){return this._locked},_getURL:function(a){return this._document.getURL(a,"ajax=1&action="+b.contextaction+"&"+(b.docvariant||""))}});b.DocumentLock._instances=
{};b.DocumentLock.get=function(a){a=c(a);a=new b.DocumentReference(a.wiki,a.space,a.page);return b.DocumentLock._instances[b.Model.serialize(a)]};var d=function(){b.EditLock=new b.DocumentLock;b.EditLock.lock();return!0};b.domIsLoaded&&d()||document.observe("xwiki:dom:loaded",d);return b}(XWiki||{});

//# sourceMappingURL=lock.min.js.map
