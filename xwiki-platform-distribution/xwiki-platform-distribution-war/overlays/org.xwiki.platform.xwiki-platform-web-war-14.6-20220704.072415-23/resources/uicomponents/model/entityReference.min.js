'use strict';var XWiki=function(u){function v(a,b,c){for(var d=-1;++d<a.length;)for(var g=0;g<b.length;g++){a:{var h=a;for(var q=d,m=b[g],n=0;n<m.length;n++){var p=q+n;if(p>=h.length||h.charAt(p)!=m.charAt(n)){h=!1;break a}}h=!0}if(h){a=a.substr(0,d)+c[g]+a.substr(d+b[g].length);d+=c[g].length-1;break}}return a}var k=0;const e={WIKI:k++,SPACE:k++,DOCUMENT:k++,ATTACHMENT:k++,OBJECT:k++,OBJECT_PROPERTY:k++,CLASS_PROPERTY:k++},r=[];Object.keys(e).forEach(a=>{const b=a.toLowerCase().split("_");r[e[a]]=
[b[0]].concat(b.slice(1).map(c=>c.substr(0,1).toUpperCase()+c.substr(1))).join("")});e.getName=function(a){return r[a]};e.byName=function(a){a=a.toLowerCase();for(var b=0;b<r.length;b++)if(r[b].toLowerCase()===a)return b;return-1};class f{constructor(a,b,c,d){this.name=a;this.type=b;this.parent=c;this.locale=d}extractReference(a){for(var b=this;b&&b.type!=a;)b=b.parent;return b}extractReferenceValue(a){return(a=this.extractReference(a))?a.name:null}relativeTo(a){var b=this.getReversedReferenceChain();
a=a?a.getReversedReferenceChain():[];for(var c,d=c=0;c<b.length&&d<a.length&&b[c].type!=a[d].type;)b[c].type>a[d].type?d++:c++;for(;c<b.length&&d<a.length&&b[c].type===a[d].type&&b[c].name===a[d].name;)c++,d++;if(d<a.length&&0<d&&a[d].type===a[d-1].type&&0<c)for(c--;0<c&&b[c].type===b[c-1].type;c--);for(var g;c<b.length;c++)g=new f(b[c].name,b[c].type,g);return g||new f("",this.type)}getReversedReferenceChain(){for(var a=[],b=this;b;)a.push(b),b=b.parent;return a.reverse()}getRoot(){for(var a=this;a.parent;)a=
a.parent;return a}appendParent(a){this.getRoot().parent=a;return this}hasParent(a){var b=this.parent;if(b==a)return!0;for(;b&&!b.equals(a);)b=b.parent;return null!=b}equals(a){return null==a||null==this.parent&&null!=a.parent||null!=this.parent&&null==a.parent?!1:this.name===a.name&&this.type===a.type&&(null==this.parent||this.parent.equals(a.parent))}toString(){return w.serialize(this)}getName(){return this.name}static fromJSONObject(a){var b=null!=a.parent?f.fromJSONObject(a.parent):void 0;return new f(a.name,
e.byName(a.type),b,a.locale)}}class x extends f{constructor(a){super(a,e.WIKI)}}class y extends f{constructor(a,b){a=new x(a);if(Array.isArray(b)&&0<b.length){var c;for(c=0;c<b.length-1;++c)a=new f(b[c],e.SPACE,a);super(b[c],e.SPACE,a)}else if("string"===typeof b||"undefined"==typeof b)super(b,e.SPACE,a);else throw"Missing mandatory space name or invalid type for: ["+b+"]";}}class E extends f{constructor(a,b,c){super(c,e.DOCUMENT,new y(a,b))}}class F extends f{constructor(a,b){super(a,e.ATTACHMENT,
b)}}class t{constructor(){this.children={};this.locales={}}_fromJSONObject(a){null!=a.reference&&(this.reference=f.fromJSONObject(a.reference));a.children.each(this._childFromJSONObject.bind(this));a.locales.each(this._localeFromJSONObject.bind(this))}_childFromJSONObject(a){var b=new t;b._fromJSONObject(a);a=this.children[b.reference.name];"undefined"==typeof a&&(a={},this.children[b.reference.name]=a);a[b.reference.type]=b}_localeFromJSONObject(a){this.locales[a.locale]=f.fromJSONObject(a)}hasChildren(){return 0!==
Object.keys(this.children).length}hasLocales(){return 0!==Object.keys(this.locales).length}getChildByReference(a){if("undefined"==typeof a)return null;var b=this;a=a.getReversedReferenceChain();for(var c=0;c<a.length;c++){var d=a[c];b=b.children[d.name];if("undefined"==typeof b)return null;b=b[d.type];if("undefined"==typeof b)return null}return b}}class z extends t{constructor(){super()}static fromJSONObject(a){var b=new z;b._fromJSONObject(a);return b}}const G=[[],[".",":","\\"],[".","\\"],["@",
"\\"],["^","\\"],[".","\\"],["^",".","\\"]],H=[[],["\\.","\\:","\\\\"],["\\.","\\\\"],["\\@","\\\\"],["\\^","\\\\"],["\\.","\\\\"],["\\^","\\.","\\\\"]],A=[[],[".",":"],[".",":"],["@",".",":"],["^",".",":"],[".","^",".",":"],["^",".",":"]],I=[null,e.WIKI,e.SPACE,e.DOCUMENT,e.DOCUMENT,e.OBJECT,e.DOCUMENT],l=[];for(k=1;k<A.length;k++)l[k]={};l[e.SPACE][":"]=e.WIKI;l[e.SPACE]["."]=e.SPACE;l[e.DOCUMENT]["."]=e.SPACE;l[e.ATTACHMENT]["@"]=e.DOCUMENT;l[e.OBJECT]["^"]=e.DOCUMENT;l[e.OBJECT_PROPERTY]["."]=
e.OBJECT;l[e.CLASS_PROPERTY]["^"]=e.DOCUMENT;const J=["\\\\","\\"],K=["\\",""];class B{resolve(a,b,c){a=(a||"").split("");b=parseInt(b);if(isNaN(b)||0>b||b>=A.length)throw"No parsing definition found for Entity Type ["+b+"]";var d=l[b];if(!d)return this._getEscapedReference(a,b,c);do{for(var g=null,h=a.length;0<=--h;){var q=a[h],m=h-1,n=0>m?0:a[m];if("number"===typeof d[q])if(0===this._getNumberOfCharsBefore("\\",a,m)%2){g=d[q];break}else a.splice(m,1),--h;else"\\"===n&&(a.splice(m,1),--h)}d=this._getNewReference(h,
a,b,c);var p=this._appendNewReference(p,d);b=g?g:I[b];d=l[b]}while(null!=d);c=this._getEscapedReference(a,b,c);return p=this._appendNewReference(p,c)}_getEscapedReference(a,b,c){return 0<a.length?(a=v(a.join(""),J,K),new f(a,b)):this._resolveDefaultReference(b,c)}_getNewReference(a,b,c,d){a<b.length-1?(d=b.slice(a+1).join(""),c=new f(d,c)):c=this._resolveDefaultReference(c,d);b.splice(Math.max(a,0),b.length);return c}_resolveDefaultReference(a,b){var c;if("object"===typeof b)if(b&&"function"===typeof b.extractReference){b=
b.extractReference(a);for(c=[];b&&b.type===a;)c.push(b.name),b=b.parent;c.reverse()}else c=b&&b[a];else"function"===typeof b&&(c=b(a));b=null;if(c&&0<c.length){"string"===typeof c&&(c=[c]);for(var d=0;d<c.length;d++)b=new f(c[d],a,b)}return b}_appendNewReference(a,b){return b?a?a.appendParent(b):b:a}_getNumberOfCharsBefore(a,b,c){for(var d=c;0<=d&&b[d]===a;)--d;return c-d}}class C{serialize(a){return a?this.serialize(a.parent)+this._serializeComponent(a):""}_serializeComponent(a){var b="",c=G[a.type];
a.parent&&(b+=a.parent.type===e.WIKI?":":c[0]);return b=0<c.length?b+v(a.name,c,H[a.type]):b+a.name.replace("\\","\\\\")}}const L=new B,M=new C,w={serialize:function(a){return M.serialize(a)},resolve:function(a,b,c){if(void 0==b&&"string"===typeof a){var d=a.indexOf(":");0<d&&(b=e.byName(a.substring(0,d)),0<=b&&(a=a.substring(d+1)))}return L.resolve(a,b,c)}},D={EntityType:e,EntityReference:f,WikiReference:x,SpaceReference:y,DocumentReference:E,AttachmentReference:F,EntityReferenceTreeNode:t,EntityReferenceTree:z,
EntityReferenceResolver:B,EntityReferenceSerializer:C,Model:w};Object.keys(D).forEach(a=>u[a]=D[a]);return u}(window.XWiki||{});

//# sourceMappingURL=entityReference.min.js.map
