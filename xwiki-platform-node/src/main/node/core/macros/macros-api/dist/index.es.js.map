{"version":3,"file":"index.es.js","sources":["../src/index.ts"],"sourcesContent":["/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\nimport type { MacroBlock, MacroInlineContent } from \"./ast\";\n\n/**\n * Information about a macro.\n *\n * @since 0.23\n * @beta\n */\ninterface MacroInfos<Parameters extends Record<string, MacroParameterType>> {\n  /** ID of the macro: only lowercase letters, uppercase letters, digits and underscores allowed */\n  id: string;\n\n  /** Name of the macro (to show in menus) */\n  name: string;\n\n  /** Description of the macro */\n  // TODO: translations [https://jira.xwiki.org/browse/CRISTAL-707]\n  description: string;\n\n  /** Macro's parameters */\n  params: Parameters;\n\n  /** Description of the macro's parameters */\n  // TODO: translations [https://jira.xwiki.org/browse/CRISTAL-707]\n  paramsDescription: { [P in keyof Parameters]: string };\n\n  /**\n   * Default parameters for the macro\n   *\n   * If `false` is provided, the macro will be hidden\n   */\n  defaultParameters:\n    | FilterUndefined<GetConcreteMacroParametersType<Parameters>>\n    | false;\n}\n\n/**\n * Description of a block macro\n *\n * @since 0.23\n * @beta\n */\ninterface BlockMacro<Parameters extends Record<string, MacroParameterType>> {\n  /** Macro informations */\n  infos: MacroInfos<Parameters>;\n\n  /** Indicator that the macro renders as a block */\n  renderAs: \"block\";\n\n  /**\n   * Render function\n   *\n   * @param params - The macro's parameters ; optional fields may be absent or equal to `undefined`\n   * @param openParamsEditor - Request the opening of an UI to edit the macro's parameters (e.g. a modal)\n   *\n   * @returns The AST to render the macro as\n   */\n  render(params: GetConcreteMacroParametersType<Parameters>): MacroBlock[];\n}\n\n/**\n * Description of an inline macro\n *\n * @since 0.23\n * @beta\n */\ninterface InlineMacro<Parameters extends Record<string, MacroParameterType>> {\n  /** Macro informations */\n  infos: MacroInfos<Parameters>;\n\n  /** Indicator that the macro renders as an inline content */\n  renderAs: \"inline\";\n\n  /**\n   * Render function\n   *\n   * @param params - The macro's parameters ; optional fields may be absent or equal to `undefined`\n   * @param openParamsEditor - Request the opening of an UI to edit the macro's parameters (e.g. a modal)\n   *\n   * @returns The AST to render the macro as\n   */\n  render(\n    params: GetConcreteMacroParametersType<Parameters>,\n  ): MacroInlineContent[];\n}\n\n/**\n * Description of a macro\n *\n * @since 0.23\n * @beta\n */\ntype Macro<Parameters extends Record<string, MacroParameterType>> =\n  | BlockMacro<Parameters>\n  | InlineMacro<Parameters>;\n\n/**\n * Description of a macro with an unknown parameters shape\n *\n * @since 0.23\n * @beta\n */\ntype MacroWithUnknownParamsType = Macro<Record<string, MacroParameterType>>;\n\n/**\n * Description of an instanciable macro with an unknown parameters shape\n *\n * @since 0.23\n * @beta\n */\n\ntype MacroClassWithUnknownParamsType = new (\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ...args: any[]\n) => MacroWithUnknownParamsType;\n\n/**\n * Description of a macro parameter's type\n *\n * The final TypeScript type will be derived through `GetConcreteMacroParameterType`\n *\n * @since 0.23\n * @beta\n */\ntype MacroParameterType = (\n  | { type: \"boolean\" }\n  // We use 'float' instead of 'number' here to make it more explicit to developers\n  | { type: \"float\" }\n  | { type: \"string\" }\n) & {\n  // Make the parameter optional\n  optional?: true;\n};\n\n/**\n * Internal utility type to remove values that may be assigned `undefined` from a record\n *\n * @since 0.23\n * @beta\n */\ntype FilterUndefined<T> = {\n  [K in keyof T as undefined extends T[K] ? never : K]: T[K];\n};\n\n/**\n * Utility type to get the concrete TypeScript type from a macro parameter's definition\n *\n * @since 0.23\n * @beta\n */\ntype GetConcreteMacroParameterType<T extends MacroParameterType> =\n  | (T[\"type\"] extends \"boolean\"\n      ? boolean\n      : T[\"type\"] extends \"float\"\n        ? number\n        : T[\"type\"] extends \"string\"\n          ? string\n          : never)\n  | (T[\"optional\"] extends true ? undefined : never);\n\n/**\n * Internal utility type making all properties that may be assigned `undefined` optional in a record\n *\n * @since 0.23\n * @beta\n */\ntype UndefinableToOptional<T> = {\n  [K in keyof T as undefined extends T[K] ? K : never]?: Exclude<\n    T[K],\n    undefined\n  >;\n} & { [K in keyof T as undefined extends T[K] ? never : K]: T[K] };\n\n/**\n * Utility type to get the concrete TypeScript record type from a macro's parameters definition\n *\n * Parameters defined as optional are both optional in the output record and can be assigned `undefined`\n *\n * @since 0.23\n * @beta\n */\ntype GetConcreteMacroParametersType<\n  T extends Record<string, MacroParameterType>,\n> = UndefinableToOptional<{\n  [Param in keyof T]: GetConcreteMacroParameterType<T[Param]>;\n}>;\n\n/**\n * Generic type for a macro's unshaped parameters\n *\n * @since 0.23\n * @beta\n */\ntype UnknownMacroParamsType = Record<string, boolean | number | string>;\n\n/**\n * Cast a macro class to an unknown-shape macro class\n *\n * @param macro - The macro class to cast\n *\n * @returns - The same macro class, without its parameters shape\n *\n * @since 0.23\n * @beta\n */\nexport function eraseParamsTypeForMacroClass<\n  Params extends Record<string, MacroParameterType>,\n>(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  macro: new (...args: any[]) => Macro<Params>,\n): MacroClassWithUnknownParamsType {\n  return macro as MacroClassWithUnknownParamsType;\n}\n\nexport type {\n  BlockMacro,\n  FilterUndefined,\n  GetConcreteMacroParameterType,\n  GetConcreteMacroParametersType,\n  InlineMacro,\n  Macro,\n  MacroClassWithUnknownParamsType,\n  MacroInfos,\n  MacroParameterType,\n  MacroWithUnknownParamsType,\n  UndefinableToOptional,\n  UnknownMacroParamsType,\n};\n\nexport type {\n  MacroAlignment,\n  MacroBlock,\n  MacroBlockStyles,\n  MacroImage,\n  MacroInlineContent,\n  MacroLink,\n  MacroLinkTarget,\n  MacroListItem,\n  MacroTableCell,\n  MacroTableColumn,\n  MacroText,\n  MacroTextStyles,\n} from \"./ast\";\n"],"names":["eraseParamsTypeForMacroClass","macro"],"mappings":"AAgOO,SAASA,EAIdC,GACiC;AACjC,SAAOA;AACT;"}