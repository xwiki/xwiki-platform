/*
 #set ($paths = {
  'treeRequireConfig': $services.webjars.url('org.xwiki.platform:xwiki-platform-tree-webjar', 'require-config.min.js',
    {'evaluate': true, 'minify': $services.debug.minify})
})
#set ($l10nKeys = [
  'core.exporter.selectChildren',
  'core.exporter.unselectChildren'
])
#set ($l10n = {})
#foreach ($key in $l10nKeys)
  #set ($discard = $l10n.put($key, $services.localization.render($key)))
#end
#set ($iconNames = ['check', 'shape_square'])
#set ($icons = {})
#foreach ($iconName in $iconNames)
  #set ($discard = $icons.put($iconName, $services.icon.getMetaData($iconName)))
#end
#[[*/
'use strict';(function(w,v,t){define("xwiki-export-tree",["jquery","tree","xwiki-entityReference"],function(d){var m=function(a,b){b.forEach(function(c){var e=a.get_node(c);!a.is_disabled(c)||0<e.children.length?a.select_node(c,!1,!0):a.is_parent(c)&&(e.original.state.undetermined=!0,e.state.undetermined=!0)})},q=function(a,b){b=b||a.get_node(d.jstree.root);b.children.forEach(function(c){a.is_disabled(c)&&a.is_undetermined(c)&&(a.get_node(c).state.selected=!0);a.deselect_node(c)})},r=function(a,b){b.forEach(function(c){if(a.is_disabled(c)&&
a.is_selected(c)){var e=a.trigger;try{a.trigger=function(){};if(!a.is_loaded(c)&&a.is_parent(c)){var g=a.get_node(c);g.original.state.undetermined=!0;g.state.undetermined=!0}a.deselect_node(c)}finally{a.trigger=e}}})},l=function(a,b,c){var e=[],g=[],p="document"===b.data.type&&b.data.id;p&&(a.is_checked(b)?e.push(p):g.push(p));p=b.children.map(function(h){return a.get_node(h)});p.filter(function(h){return"document"===h.data.type}).forEach(function(h){var n=h.data.id;a.is_leaf(h)?a.is_checked(h)?e.push(n):
g.push(n):(n=XWiki.Model.resolve(n,XWiki.EntityType.DOCUMENT),n=XWiki.Model.serialize(new XWiki.EntityReference("%",XWiki.EntityType.DOCUMENT,n.parent)),a.is_checked(h)&&!a.is_loaded(h)?e.push(n):g.push(n))});var u=p.find(h=>"pagination"===h.data.type);!a.is_loaded(b)&&a.is_undetermined(b)||u&&a.is_checked(u)||!u&&a.is_checked(b)?(b=XWiki.Model.resolve(b.data.id,XWiki.EntityType.byName(b.data.type)),b.type===XWiki.EntityType.DOCUMENT?b=b.parent:b.type===XWiki.EntityType.WIKI&&(b=new XWiki.EntityReference("%",
XWiki.EntityType.SPACE,b)),b=new XWiki.EntityReference("%",XWiki.EntityType.DOCUMENT,b),b=XWiki.Model.serialize(b),c[b]=g):e.forEach(function(h){c[h]=[]});p.forEach(function(h){a.is_leaf(h)||!a.is_loaded(h)&&!a.is_undetermined(h)||l(a,h,c)})},f={getExportPages:function(){var a={};l(this,this.get_node(d.jstree.root),a);return a},hasExportPages:function(){return 0<this.get_checked().length||0<this.get_undetermined().length},isExportingAllPages:function(){for(var a=this.get_json(null,{flat:!0,no_data:!0,
no_state:!0,no_a_attr:!0,no_li_attr:!0}),b=0;b<a.length;b++){var c=a[b].id;if(!this.is_selected(c)&&!this.is_undetermined(c))return!1}return!0}},k={plugins:["checkbox","contextmenu"],checkbox:{cascade:"down+undetermined",three_state:!1},contextmenu:{select_node:!1,items:function(a){var b=d.jstree.reference(a);return{select_children:{label:v["core.exporter.selectChildren"],icon:t.check.cssClass||t.check.url,action:function(){var c=a;c=c||b.get_node(d.jstree.root);m(b,c.children)},_disabled:!b.is_open(a)},
unselect_children:{label:v["core.exporter.unselectChildren"],icon:t.shape_square.cssClass||t.shape_square.url,action:function(){q(b,a)},_disabled:!b.is_open(a)}}}}};d.fn.exportTree=function(a){return this.on("select_node.jstree select_all.jstree",function(b,c){r(c.instance,c.instance.get_selected().slice())}).on("model.jstree",function(b,c){var e=c.instance;c.nodes.forEach(function(g){g=e.get_node(g);g.original.state=g.original.state||{}});e.is_selected(c.parent)?r(e,c.nodes):e.is_disabled(c.parent)&&
e.is_undetermined(c.parent)&&m(e,c.nodes)}).on("click",".jstree-anchor.jstree-disabled",function(b){d(this).jstree("toggle_node",b.target)}).one("ready.jstree",function(b,c){var e=c.instance;d.extend(e,f);e.select_all();d(this).closest(".export-tree-container").find(".export-tree-action.selectAll").on("click",function(g){g.preventDefault();e.select_all()}).addBack().find(".export-tree-action.selectNone").on("click",function(g){g.preventDefault();e.deselect_all()})}).xtree(d.extend(!0,{},k,a))}});
define("xwiki-export-tree-filter",["jquery","bootstrap","xwiki-export-tree"],function(d){var m=/filters=(\w*)/,q=function(a){return(a=m.exec(a))&&a[1]||""},r=function(a){var b=a.attr("data-url");b=q(b);var c=a.data("exportTreeFilter");c||(c={},a.data("exportTreeFilter",c));a=d.jstree.reference(a);c[b]={children:a.get_json(),data:a.get_node(d.jstree.root).data}},l,f=function(a,b){if(a.id===d.jstree.root){var c=this.get_container();var e=c.attr("data-url");e=q(e);if(c=c.data("exportTreeFilter")[e])return a.data=
c.data,b(c.children)}return l.apply(this,arguments)},k=function(a,b){r(a);var c=a.attr("data-url");c=m.test(c)?c.replace(m,"filters="+encodeURIComponent(b)):c+("&filters="+encodeURIComponent(b));a.attr("data-url",c);var e=d.jstree.reference(a);e.settings.core.data!==f&&(l=e.settings.core.data,e.settings.core.data=f);if(b=!!a.data("exportTreeFilter")[b]){var g=e.settings.checkbox.cascade;e.settings.checkbox.cascade="";a.one("refresh.jstree",function(){e.settings.checkbox.cascade=g})}e.refresh(b)};
d(document).on("click",".export-tree-filter a",function(a){a.preventDefault();var b=d(this).closest("li");b.hasClass("active")||(a=b.closest(".export-tree-filter"),a.find("li.active").removeClass("active"),b.addClass("active"),b=d(this).data("filter")||"",a.find('input[name="filter"]').val(b),a.find(".active-filter-title").text(d(this).find(".export-tree-filter-title").text()),a=a.closest(".export-tree-container").find(".export-tree"),k(a,b))})});require(["jquery",w.treeRequireConfig],function(d){var m=
function(f,k){f=f.getExportPages();for(var a in f)d("<input/>").attr({type:"hidden",name:"pages",value:a}).appendTo(k),d("<input/>").attr({type:"hidden",name:"excludes",value:r(f[a])}).appendTo(k)};d("#targetXWikiVersion").on("change",function(){d("#targetXWikiVersionSettings fieldset").prop("disabled",!0);d('#targetXWikiVersionSettings fieldset[data-version-range="'+d(this).val()+'"]').prop("disabled",!1)});d(".export-tree").on("ready.jstree, changed.jstree",function(f,k){f=k.instance;d(this).closest("form#export").find('input[type="submit"]').prop("disabled",
!f.hasExportPages())});var q=d('<div class="hidden"></div>').insertAfter(".export-tree");d("form#export").on("submit",function(){var f=d.jstree.reference(d(this).find(".export-tree"));f&&!f.isExportingAllPages()&&m(f,q.empty())});d(".export-tree").on("ready.jstree, changed.jstree",function(f,k){f=k.instance;d(this).closest("#exportModalOtherCollapse").find(".export-buttons a.btn").toggleClass("disabled",!f.hasExportPages())});var r=function(f){return f.map(function(k){return encodeURIComponent(k)}).join("&")},
l=d("<form></form>").attr({id:"export-modal-form",method:"post"}).appendTo("body");d("#exportModalOtherCollapse").on("click","a.btn-primary",function(f){var k=d(this).closest("#exportModalOtherCollapse").find(".export-tree");0<k.length&&(f.preventDefault(),d(this).hasClass("disabled")||(l.empty().attr("action",d(this).attr("href").replace(/pages=.*?(&|$)/g,"")),m(d.jstree.reference(k),l),d(this).closest("#exportModalOtherCollapse").find('input[type="hidden"][name="filter"]').clone().appendTo(l),l.submit()))});
require(["xwiki-export-tree","xwiki-export-tree-filter"],function(){d(".export-tree").exportTree()})})}).apply("]]#",$jsontool.serialize([$paths,$l10n,$icons]));

//# sourceMappingURL=exporter.min.js.map
