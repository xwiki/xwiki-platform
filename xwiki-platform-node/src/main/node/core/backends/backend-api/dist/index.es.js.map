{"version":3,"file":"index.es.js","sources":["../src/abstractStorage.ts","../src/defaultStorageProvider.ts","../src/componentInit.ts"],"sourcesContent":["/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { injectable, unmanaged } from \"inversify\";\nimport type {\n  AttachmentsData,\n  Logger,\n  PageAttachment,\n  PageData,\n  Storage,\n  WikiConfig,\n} from \"@xwiki/cristal-api\";\n\n/**\n * @since 1.0\n * @beta\n */\n@injectable()\nexport abstract class AbstractStorage implements Storage {\n  protected logger: Logger;\n  // @ts-expect-error wikiConfig is temporarily undefined during class\n  // initialization\n  protected wikiConfig: WikiConfig;\n\n  constructor(@unmanaged() logger: Logger, module: string) {\n    this.logger = logger;\n    this.logger.setModule(module);\n  }\n\n  setWikiConfig(wikiConfig: WikiConfig): void {\n    this.logger.debug(\"Setting wiki Config: \", wikiConfig);\n    this.wikiConfig = wikiConfig;\n  }\n\n  getWikiConfig(): WikiConfig {\n    return this.wikiConfig;\n  }\n\n  abstract getEditField(\n    jsonArticle: object,\n    fieldName: string,\n  ): Promise<string>;\n\n  abstract getImageURL(page: string, image: string): string;\n\n  abstract getPageContent(\n    page: string,\n    syntax: string,\n    revision?: string,\n  ): Promise<PageData | undefined>;\n\n  /**\n   * Returns the list of attachments of a given page.\n   * TODO: this API is missing pagination.\n   * @since 0.9\n   * @beta\n   */\n  abstract getAttachments(page: string): Promise<AttachmentsData | undefined>;\n\n  /**\n   * @since 0.12\n   * @beta\n   */\n  abstract getAttachment(\n    page: string,\n    name: string,\n  ): Promise<PageAttachment | undefined>;\n\n  abstract getPageFromViewURL(url: string): string | null;\n\n  abstract getPageRestURL(\n    page: string,\n    syntax: string,\n    revision?: string,\n  ): string;\n\n  abstract getPanelContent(\n    panel: string,\n    contextPage: string,\n    syntax: string,\n  ): Promise<PageData>;\n\n  abstract isStorageReady(): Promise<boolean>;\n\n  /**\n   * Save a page and its content to the give syntax.\n   *\n   * @param page - the page to save\n   * @param title - the raw page title\n   * @param content - the content of the page\n   * @param syntax - the syntax of the content\n   *\n   * @since 0.8\n   * @beta\n   */\n  abstract save(\n    page: string,\n    title: string,\n    content: string,\n    syntax: string,\n  ): Promise<unknown>;\n\n  /**\n   * @param page - the serialized reference of the page\n   * @param files - the list of files to upload\n   * @returns (since 0.20) an optional list of resolved attachments URL (in the same order as the provided files). This\n   *   is useful in the case where the url cannot be resolved from the name of the file and its document reference\n   *   alone.\n   * @since 0.9\n   * @beta\n   */\n  abstract saveAttachments(\n    page: string,\n    files: File[],\n  ): Promise<undefined | (string | undefined)[]>;\n\n  /**\n   * Delete a page.\n   *\n   * @param page - the page to delete\n   * @returns true if the delete was successful, false with the reason otherwise\n   *\n   * @since 0.11\n   * @beta\n   */\n  abstract delete(page: string): Promise<{ success: boolean; error?: string }>;\n\n  /**\n   * Move a page.\n   *\n   * @param page - the page to move\n   * @param newPage - the new location for the page\n   * @param preserveChildren - whether to move children\n   * @returns true if the move was successful, false with the reason otherwise\n   *\n   * @since 0.14\n   * @beta\n   */\n  abstract move(\n    page: string,\n    newPage: string,\n    preserveChildren: boolean,\n  ): Promise<{ success: boolean; error?: string }>;\n}\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { inject, injectable } from \"inversify\";\nimport type { StorageProvider } from \"./storageProvider\";\nimport type { CristalApp, Storage } from \"@xwiki/cristal-api\";\n\n/**\n * Provide the current storage.\n * @since 0.13\n * @beta\n */\n@injectable()\nclass DefaultStorageProvider implements StorageProvider {\n  constructor(@inject(\"CristalApp\") private readonly cristalApp: CristalApp) {}\n\n  get(): Storage {\n    return this.cristalApp.getWikiConfig().storage;\n  }\n}\n\nexport { DefaultStorageProvider };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { DefaultStorageProvider } from \"./defaultStorageProvider\";\nimport { Container } from \"inversify\";\nimport type { StorageProvider } from \"./storageProvider\";\n\n/**\n * @beta\n */\nexport class ComponentInit {\n  constructor(container: Container) {\n    container\n      .bind<StorageProvider>(\"StorageProvider\")\n      .to(DefaultStorageProvider)\n      .inSingletonScope();\n  }\n}\n"],"names":["AbstractStorage","logger","module","wikiConfig","__decorateClass","injectable","__decorateParam","unmanaged","DefaultStorageProvider","cristalApp","ComponentInit","container"],"mappings":";;;;;;AAmCO,IAAeA,IAAf,MAAkD;AAAA,EAC7C;AAAA;AAAA;AAAA,EAGA;AAAA,EAEV,YAAyBC,GAAgBC,GAAgB;AACvD,SAAK,SAASD,GACd,KAAK,OAAO,UAAUC,CAAM;AAAA,EAC9B;AAAA,EAEA,cAAcC,GAA8B;AAC1C,SAAK,OAAO,MAAM,yBAAyBA,CAAU,GACrD,KAAK,aAAaA;AAAA,EACpB;AAAA,EAEA,gBAA4B;AAC1B,WAAO,KAAK;AAAA,EACd;AA2GF;AA7HsBH,IAAfI,EAAA;AAAA,EADNC,EAAA;AAAA,EAOcC,EAAA,GAAAC,EAAA,CAAU;AAAA,GANHP,CAAA;;;;;;ACLtB,IAAMQ,IAAN,MAAwD;AAAA,EACtD,YAAmDC,GAAwB;AAAxB,SAAA,aAAAA;AAAA,EAAyB;AAAA,EAE5E,MAAe;AACb,WAAO,KAAK,WAAW,cAAA,EAAgB;AAAA,EACzC;AACF;AANMD,IAANJ,EAAA;AAAA,EADCC,EAAA;AAAA,EAEcC,OAAO,YAAY,CAAA;AAAA,GAD5BE,CAAA;ACHC,MAAME,EAAc;AAAA,EACzB,YAAYC,GAAsB;AAChC,IAAAA,EACG,KAAsB,iBAAiB,EACvC,GAAGH,CAAsB,EACzB,iBAAA;AAAA,EACL;AACF;"}