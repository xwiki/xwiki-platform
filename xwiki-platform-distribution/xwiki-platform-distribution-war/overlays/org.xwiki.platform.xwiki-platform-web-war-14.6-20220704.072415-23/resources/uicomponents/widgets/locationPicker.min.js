/*
 #set ($paths = {
  'treeRequireConfig': $services.webjars.url('org.xwiki.platform:xwiki-platform-tree-webjar', 'require-config.min.js',
    {'evaluate': true, 'minify': $services.debug.minify})
})
#set ($l10nKeys = [
  'entitynamevalidation.nametransformation.error',
  'core.validation.valid.message',
  'core.validation.required.message',
  'core.validation.required.message.terminal'
])
#set ($l10n = {})
#foreach ($key in $l10nKeys)
  #set ($discard = $l10n.put($key, $services.localization.render($key)))
#end
#[[*/
'use strict';(function(A,y){require([A.treeRequireConfig],function(){require(["tree"],function(g){g(".location-picker").each(function(){var r=g(this),p=r.find(".location-action-pick"),m=r.find(".modal"),q=m.find(".location-tree"),e=m.find(".modal-footer .btn-primary");p.on("click",function(c){c.preventDefault();m.modal()});m.on("shown.bs.modal",function(c){var n=p.attr("data-openTo");n&&n!==m.data("openTo")?m.data("openTo",n):n=!1;c=g.jstree.reference(q);if(c)n&&(c.deselect_all(),c.close_all(),c.openTo(n));
else q.xtree({core:{multiple:"true"===q.data("multiple")}}).one("ready.jstree",function(a,b){n&&b.instance.openTo(n)}).on("changed.jstree",function(a,b){e.prop("disabled",!b.selected.length)}).on("dblclick",".jstree-anchor",function(){e.click()})});e.on("click",function(){m.modal("hide");m.triggerHandler("xwiki:locationTreePicker:select",{tree:g.jstree.reference(q)})})})})});require(["jquery","xwiki-meta"],function(g,r){g(".location-picker").each(function(){var p=g(this),m=p.find(".location-wiki-field"),
q=p.find("input.location-parent-field");p.find(".location-action-pick").on("click",function(e){e=m.val()||r.wiki;var c="wiki:"+e;q.val()&&(e=XWiki.Model.resolve(q.val(),XWiki.EntityType.SPACE,[e]),e=new XWiki.EntityReference("WebHome",XWiki.EntityType.DOCUMENT,e),c="document:"+XWiki.Model.serialize(e));g(this).attr("data-openTo",c)});p.find(".modal").on("xwiki:locationTreePicker:select",function(e,c){c=c.tree.get_selected()[0];var n=c.indexOf(":");e=c.substr(0,n);c=c.substr(n+1);c=XWiki.Model.resolve(c,
XWiki.EntityType.byName(e));e=c.extractReference(XWiki.EntityType.WIKI);m.val(e?e.name:"");e=(c=c.extractReference(XWiki.EntityType.SPACE))?XWiki.Model.serialize(c.relativeTo(e)):"";q.val(e);q.triggerHandler("input")})})});require(["jquery","xwiki-meta","xwiki-events-bridge"],function(g,r){g(".location-picker").each(function(){var p=g(this),m=p.closest("form"),q=m.find("input[type=submit]:not([disabled=disabled]),input[type=button]:not([disabled=disabled]),button:not([disabled=disabled])"),e=m.find("a.button:not(.disabled)"),
c=p.find("input.location-title-field"),n=p.find(".location-wiki-field"),a=p.find("input.location-parent-field"),b=p.find("input.location-name-field"),d=p.find(".breadcrumb"),h,k=function(l){var f=XWiki.currentDocument.getURL("get");return Promise.resolve(g.get(f,{xpage:"entitynamevalidation_json",outputSyntax:"plain",name:l,form_token:r.form_token}))},t=function(l){var f=d.children(".preview");0===f.length&&(f=g(document.createElement("li")).addClass("preview active").appendTo(d));f.text(l)},w,x=
function(l){q.prop("disabled",!0);e.addClass("disabled");var f=c.val();k(f).then(u=>{f===c.val()&&(b.val(u.transformedName).trigger("change"),t(c.val()))}).catch(()=>{f===c.val()&&(new XWiki.widgets.Notification(y["entitynamevalidation.nametransformation.error"],"error"),b.val(f).trigger("change"),t(c.val()))}).finally(()=>{q.prop("disabled",!1);e.removeClass("disabled");l&&c.closest("form").submit()})};m=function(l,f){var u=f?f.value:a.val();clearTimeout(h);h=setTimeout(function(){z(n.val(),u)},
500)};var z=function(l,f){l=l||n.val();f=f||a.val();var u=XWiki.Model.resolve(f||r.space,XWiki.EntityType.SPACE),B=new XWiki.EntityReference("WebHome",XWiki.EntityType.DOCUMENT,u);l&&u.appendParent(new XWiki.WikiReference(l));g.post(C(),{xpage:"hierarchy_reference",reference:XWiki.Model.serialize(B)},function(v){v=g(v);d.replaceWith(v);d=v;f||d.find("li").not(".wiki").remove();d.find(".active").removeClass("active");v=c.val();t(v?v:b.val())})},C=function(){var l=XWiki.Model.resolve(r.space,XWiki.EntityType.SPACE).getReversedReferenceChain().map(function(u){return encodeURIComponent(u.name)}).join("/"),
f=XWiki.Document.URLTemplate;f=f.replace("__space__",l);f=f.replace("__page__",r.page);return f=f.replace("__action__","get")};c.on("input change keyup",function(l){clearTimeout(w);"input"===l.type?w=setTimeout(x,500):"change"===l.type?x():"keyup"===l.type&&13===l.keyCode&&x(!0)});n.on("change",function(l){z(n.val())});b.on("input change",function(l){c.val()||t(b.val())});a.on("input change xwiki:suggest:selected",m);a.val()||m();void 0!==b.val()&&!b.val()&&c.val()?x():t(c.val());var D=p.find(".location-edit");
p.find(".location-action-edit").on("click",function(l){l.preventDefault();D.toggleClass("hidden")})})});require(["jquery"],function(g){var r=function(a){return 0<a.find(".location-actions").length&&0==a.find(".location-action-edit").length},p=function(a){var b=a.find("input.location-name-field");if(0===b.length)return null;var d=a.find("input.location-title-field");a=0<d.length&&r(a);var h=new LiveValidation(b[0],{validMessage:y["core.validation.valid.message"],insertAfterWhatNode:a?d[0]:b[0]});h.displayMessageWhenEmpty=
!0;h.add(Validate.Custom,{failureMessage:y["core.validation.required.message"],against:function(k){return!b.hasClass("empty")&&"string"===typeof k&&0<k.strip().length}});d.on("input",function(){setTimeout(function(){h.validate()},0)});b.on("change",function(){h.validate()});return h},m=function(a){var b=a.find("input.location-parent-field");if(0<b.length){var d=a.find(".breadcrumb-container");a=0<d.length&&r(a);b=new LiveValidation(b[0],{validMessage:y["core.validation.valid.message"],onlyOnBlur:!0,
insertAfterWhatNode:a?d[0]:b[0]});b.displayMessageWhenEmpty=!0;return b}return null},q=function(a,b,d){a._customValuesParams&&(a.remove(Validate.Custom,a._customValuesParams),delete a._customValuesParams);0<b.length&&(a._customValuesParams={failureMessage:d,against:function(h){for(var k=0;k<b.length;k++){var t=b[k];if(t===h||0===h.indexOf(t+"."))return!0}return!1}},a.add(Validate.Custom,a._customValuesParams))},e=function(a,b){a.add(Validate.Custom,{failureMessage:y["core.validation.required.message.terminal"],
against:function(d){return b.prop("checked")?"string"===typeof d&&0<d.strip().length:!0}});b.on("change",function(){a.validate()})},c=function(a,b){a.on("change",function(){a.prop("checked")&&b.prop("checked",!1)});b.on("change",function(){b.prop("checked")&&a.prop("checked",!1)})},n=[];g(".location-picker").each(function(){var a=g(this),b=[],d=m(a);d&&(b.push(d),a.data("spaceValidator",d));var h=p(a);h&&(b.push(h),a.data("pageValidator",h));n.push.apply(n,b);var k=a.find(".location-edit"),t=a.find(".location-action-edit");
a.closest("form").on("submit",function(w){!LiveValidation.massValidate(b)&&k.hasClass("hidden")&&t.click()});a.find("input.location-parent-field").on("input",function(){d.validate()})});g("form#create").each(function(){var a=g(this),b=a.find(".location-picker").data("spaceValidator");e(b,a.find("#terminal"));var d=function(k){var t="true"==k.attr("data-restrictions-are-suggestions"),w=[],x=k.attr("data-allowed-spaces");!t&&x&&(w=JSON.parse(k.attr("data-allowed-spaces")));k=k.attr("data-allowed-spaces-message");
q(b,w,k)};a.find(".xwiki-select").on("xwiki:select:updated",function(k){k=g('input[name="type"]:checked');d(k);b.validate()});var h=a.find('input[name="templateprovider"]');0==h.length&&(h=a.find('.xwiki-select input[name="type"]:checked'));d(h)});g("form#copy, form#rename").each(function(){var a=g(this),b=a.find(".location-picker").data("spaceValidator"),d=a.find('input[name="terminal"]'),h=a.find('input[name="deep"]'),k=a.find('select[name="language"]');e(b,d);c(h,d);k.on("change",function(){"ALL"===
k.val()?h.prop("disabled",!1):h.prop({checked:!1,disabled:!0})})})})}).apply("]]#",$jsontool.serialize([$paths,$l10n]));

//# sourceMappingURL=locationPicker.min.js.map
