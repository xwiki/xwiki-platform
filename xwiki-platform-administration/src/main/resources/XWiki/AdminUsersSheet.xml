<?xml version="1.0" encoding="ISO-8859-1"?>

<xwikidoc>
<web>XWiki</web>
<name>AdminUsersSheet</name>
<language></language>
<defaultLanguage></defaultLanguage>
<translation>0</translation>
<parent>XWiki.AdminSheet</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1211801430000</creationDate>
<date>1240954259000</date>
<contentUpdateDate>1240954259000</contentUpdateDate>
<version>1.1</version>
<title>AdminUsersSheet</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/1.0</syntaxId>
<hidden>false</hidden>
<content>### Globally administrate the users in a wiki.
#set($formname = "update")
#set($saveaction = "save")
##
## set the new interface from xwiki.cfg
##
#set($interface = $xwiki.rightsmanager.defaultUi)
##############################
## display the new interface
##############################
#if($interface == "new")
##
## inject needed JS and CSS files
##
#set($ok = $xwiki.jsfx.use("js/xwiki/lightbox/lightbox.js", true))
#set($ok = $xwiki.jsfx.use("js/xwiki/usersandgroups/usersandgroups.js", true))
#set($ok = $xwiki.ssfx.use("js/xwiki/usersandgroups/usersandgroups.css", true))
#set($ok = $xwiki.jsfx.use("js/xwiki/table/livetable.js", true))
#set($ok = $xwiki.ssfx.use("js/xwiki/table/livetable.css", true))
##
## url to get the users for displaying them in the ajax-based table
##
#set($url = "?xpage=getusers")
#if($context.database != "xwiki") 
  #set($mainwk = false) 
#else 
  #set($mainwk = true) 
#end
&lt;div id="xwikieditcontent"&gt;
  &lt;table id="userstable" class="xwiki-livetable"&gt;
    &lt;tr&gt;
      &lt;td class="xwiki-livetable-pagination" colspan="2"&gt;
        &lt;span id="userstable-limits" class="xwiki-livetable-limits"&gt;&lt;/span&gt;
        &lt;span id="userstable-ajax-loader" class="xwiki-livetable-loader"&gt;&lt;img src="$xwiki.getSkinFile('icons/ajax-loader.gif')" alt="$msg.get('xe.livetable.loading')" title="" /&gt;$msg.get("xe.livetable.loading")&lt;/span&gt;
        &lt;span class="pagination"&gt;
          &lt;span id="userstable-pagination-text" class="xwiki-livetable-pagination-text"&gt;$msg.get("xe.pagination.page")&lt;/span&gt;
          &lt;span id="userstable-pagination" class="xwiki-livetable-pagination-content" &gt;&lt;/span&gt;
        &lt;/span&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class="xwiki-livetable-display-container"&gt;
        &lt;table class="xwiki-livetable-display"&gt;
          &lt;thead class="xwiki-livetable-display-header"&gt;
             &lt;tr&gt;
               &lt;th class="xwiki-livetable-display-header-text"&gt;$msg.get("username")&lt;/th&gt;
               &lt;th class="xwiki-livetable-display-header-text"&gt;$msg.get("firstname")&lt;/th&gt;
               &lt;th class="xwiki-livetable-display-header-text"&gt;$msg.get("lastname")&lt;/th&gt;
               &lt;th class="xwiki-livetable-display-header-text"&gt;$msg.get("rightsmanager.manage")&lt;/th&gt;
             &lt;/tr&gt;
             &lt;tr id="userstable-filters" class="xwiki-livetable-display-filters"&gt;
                &lt;td class="xwiki-livetable-display-header-filter"&gt;&lt;input name="name" type="text" class="filter"/&gt;&lt;/td&gt;
                &lt;td class="xwiki-livetable-display-header-filter"&gt;&lt;input name="first_name" type="text" class="filter"/&gt;&lt;/td&gt;
                &lt;td class="xwiki-livetable-display-header-filter"&gt;&lt;input name="last_name" type="text" class="filter"/&gt;&lt;/td&gt;
                &lt;td class="xwiki-livetable-display-header-filter"&gt;
                  #if(!$mainwk)
                    &lt;select name="wiki" class="filter"&gt;
                      &lt;option value="local" selected="selected"&gt;$msg.get("rightsmanager.local")&lt;/option&gt;
                      &lt;option value="global"&gt;$msg.get("rightsmanager.global")&lt;/option&gt;
                      &lt;option value="both"&gt;$msg.get("rightsmanager.both")&lt;/option&gt;
                    &lt;/select&gt;
  		  #else 
                    &lt;input name="wiki" type="hidden" value="local" /&gt; 
                  #end
                &lt;/td&gt;
             &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody id="userstable-display" class="xwiki-livetable-display-body"&gt;
            &lt;tr&gt;
              &lt;td colspan="4"&gt;&amp;nbsp;&lt;/td&gt;
            &lt;/tr&gt;
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;&lt;td colspan="3" id="tdAddNewUserOrGroup"&gt;      
      &lt;span class="buttonwrapper"&gt;&lt;a href="#" id="addNewUser" class="addNewUserOrGroup"&gt;$msg.get("rightsmanager.addnewuser")&lt;/a&gt;&lt;/span&gt;
    &lt;/td&gt;&lt;/tr&gt;
  &lt;/table&gt;
  {pre}
   &lt;script type="text/javascript"&gt;
  //&lt;![CDATA[
       var ta = new XWiki.widgets.LiveTable("$url", "userstable", displayUsers); 
       #if(!$xwiki.hasAccessLevel("view","XWiki.Registration") || $xwiki.getDocument("XWiki.Registration").isNew())
         #set($registerurl = $doc.getURL("view", "xpage=registeruser"))
         #set($saveurl = $doc.getURL("register", "xpage=registeruser"))
         #set($redirectuserurl = $xwiki.getDocument("XWiki.XWikiPreferences").getURL("admin", "editor=${editor}&amp;section=Users")) 
         Event.observe($('addNewUser'), "click", makeAddHandler("$registerurl", "$saveurl", "$redirectuserurl"));
       #else
         ## go to custom registration page
         $('addNewUser').href = "$xwiki.getURL('XWiki.Registration')";
       #end
  //]]&gt;
   &lt;/script&gt;
  {/pre}
&lt;/div&gt; ## end of xwikieditcontent
##############################
## display the old interface
##############################
#else 
 &lt;div id="xwikieditcontent"&gt;
  &lt;p&gt;$xwiki.parseMessage("editusersredirect")&lt;/p&gt;
 &lt;/div&gt;
#end</content>
</xwikidoc>
