/*
 #set ($l10nKeys = [
  'core.viewers.attachments.upload.addFileInput',
  'core.viewers.attachments.upload.removeFileInput',
  'core.viewers.attachments.upload.removeFileInput.title',
  'core.viewers.attachments.delete.inProgress',
  'core.viewers.attachments.delete.done',
  'core.viewers.attachments.delete.failed',
  ['docextra.extranb', '__number__'],
  'docextra.attachments'
])
#set ($l10n = {})
#foreach ($key in $l10nKeys)
  #set ($params = $key.subList(1, $key.size()))
  #if ($params)
    #set ($discard = $l10n.put($key[0], $services.localization.render($key[0], $params)))
  #else
    #set ($discard = $l10n.put($key, $services.localization.render($key)))
  #end
#end
#[[*/
'use strict';(function(e){window.XWiki=window.XWiki||{};var f=XWiki.viewers=XWiki.viewers||{};f.Attachments=Class.create({counter:1,initialize:function(){$("attachform")?this.prepareForm():this.addTabLoadListener()},prepareForm:function(){if($("attachform")){this.form=$("attachform").up("form");this.defaultFileDiv=this.form.down("input[type='file']").up("div");this.inputSize=this.form.down("input[type='file']").size;var a=this.attachHTML5Uploader(this.form.down("input[type='file']"));a?a.hideFormButtons():
(this.addInitialRemoveButton(),this.addAddButton(),this.resetOnCancel());this.blockEmptySubmit()}},attachHTML5Uploader:function(a){return"undefined"!=typeof XWiki.FileUploader?(a.multiple=!0,new XWiki.FileUploader(a,{responseContainer:$("_attachments"),responseURL:XWiki.currentDocument.getURL("get","xpage=attachmentslist&forceTestRights=1"),maxFilesize:parseInt(a.readAttribute("data-max-file-size"))})):!1},addInitialRemoveButton:function(){this.defaultFileDiv.appendChild(this.createRemoveButton())},
addAddButton:function(){var a=new Element("input",{type:"button",value:e["core.viewers.attachments.upload.addFileInput"],className:"attachmentActionButton add-file-input"});this.addDiv=new Element("div");this.addDiv.appendChild(a);Event.observe(a,"click",this.addField.bindAsEventListener(this));this.defaultFileDiv.up().insertBefore(this.addDiv,this.defaultFileDiv.next())},blockEmptySubmit:function(){Event.observe(this.form,"submit",this.onSubmit.bindAsEventListener(this))},resetOnCancel:function(){Event.observe(this.form,
"reset",this.onReset.bindAsEventListener(this));Event.observe(this.form.down(".cancel"),"click",this.onReset.bindAsEventListener(this))},addField:function(a){var c=new Element("input",{type:"file",name:"filepath_"+this.counter,size:this.inputSize,className:"uploadFileInput"}),b=new Element("input",{type:"hidden",name:"filename_"+this.counter}),d=this.createRemoveButton(),g=new Element("div",{"class":"fileupload-field"});g.insert(b).insert(c).insert(d);this.addDiv.parentNode.insertBefore(g,this.addDiv);
a.element().blur();this.counter++},removeField:function(a){a.element().up("div").remove()},createRemoveButton:function(){var a=new Element("input",{type:"button",value:e["core.viewers.attachments.upload.removeFileInput"],title:e["core.viewers.attachments.upload.removeFileInput.title"],className:"attachmentActionButton remove-file-input"});Event.observe(a,"click",this.removeField.bindAsEventListener(this));return a},onSubmit:function(a){var c=!1;this.form.getInputs("file").each(function(b){""!=b.value&&
(c=!0)});c||a.stop()},onReset:function(a){a&&a.stop();this.form.getInputs("file").each(function(c){c.up().remove()});this.counter=1;this.addField(a)},addTabLoadListener:function(a){a=function(c){"Attachments"==c.memo.id&&this.prepareForm()}.bindAsEventListener(this);document.observe("xwiki:docextra:loaded",a)}});XWiki.domIsLoaded&&new f.Attachments||document.observe("xwiki:dom:loaded",function(){new f.Attachments});require(["jquery","xwiki-events-bridge"],function(a){a(document).on("show.bs.modal",
"#deleteAttachment",function(b){a(this).data("relatedTarget",a(b.relatedTarget))});a(document).on("click","#deleteAttachment input.btn-danger",function(){var b=a("#deleteAttachment").data("relatedTarget"),d;a.ajax({url:b.prop("href"),beforeSend:function(){b.prop("disabled",!0);d=new XWiki.widgets.Notification(e["core.viewers.attachments.delete.inProgress"],"inprogress")},success:function(){b.closest(".attachment").remove();c();d.replace(new XWiki.widgets.Notification(e["core.viewers.attachments.delete.done"],
"done"))},error:function(){b.prop("disabled",!1);d.replace(new XWiki.widgets.Notification(e["core.viewers.attachments.delete.failed"],"error"))}})});var c=function(){var b=a("#Attachmentstab").find(".itemCount"),d=a("#Attachmentspane .attachment").length;b&&b.text(e["docextra.extranb"].replace("__number__",d));a("#tmAttachments").length&&(a("#tmAttachments")[0].normalize(),b=" "+e["docextra.attachments"]+" "+e["docextra.extranb"],b=b.replace("__number__",d),a("#tmAttachments").contents().last()[0].nodeValue=
b)};a(document).on("xwiki:html5upload:done",function(){c()});a(document).on("xwiki:docextra:loaded",function(b,d){"Attachments"===d.id&&c()})})}).apply("]]#",$jsontool.serialize([$l10n]));

//# sourceMappingURL=attachments.min.js.map
