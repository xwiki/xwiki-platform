'use strict';var image_path="",image_up="$xwiki.getSkinFile('js/xwiki/table/img/arrow-up.gif')",image_down="$xwiki.getSkinFile('js/xwiki/table/img/arrow-down.gif')",image_none="$xwiki.getSkinFile('js/xwiki/table/img/arrow-none.gif')",TblId,StartRow,SearchFlt,ModFn,ModFnId;TblId=[];StartRow=[];ModFn=[];ModFnId=[];addEvent(window,"load",init_sortnfilter);var SORT_COLUMN_INDEX;function init_sortnfilter(){sortables_init();filterable_init()}
function sortables_init(){if(document.getElementsByTagName)for(var a=document.getElementsByTagName("table"),b=0;b<a.length;b++){var c=a[b];-1!=(" "+c.className+" ").indexOf("sortable")&&c.id&&ts_makeSortable(c)}}function filterable_init(){if(document.getElementsByTagName)for(var a=document.getElementsByTagName("table"),b=0;b<a.length;++b){var c=a[b];-1!=(" "+c.className+" ").indexOf("filterable")&&c.id&&setFilterGrid(c.id,getHeaderRow(c))}}
function ts_resortTable(a){for(var b,c,d=0;d<a.childNodes.length;++d)a.childNodes[d].tagName&&"span"==a.childNodes[d].tagName.toLowerCase()&&(b=a.childNodes[d]);var e=a.parentNode;d=e.cellIndex;e=getParent(e,"TABLE");if(!(1>=e.rows.length)){var g=ts_getInnerText(e.rows[getHeaderRow(e)+1].cells[d]);for(c=getHeaderRow(e)+2;!g;)g=ts_getInnerText(e.rows[c].cells[d]),++c;g||="";c=ts_sort_caseinsensitive;g.match(/^\d\d[\/-]\d\d[\/-]\d\d\d\d$/)&&(c=ts_sort_date);g.match(/^\d\d[\/-]\d\d[\/-]\d\d$/)&&(c=ts_sort_date);
g.match(/^[Â£$]/)&&(c=ts_sort_currency);g.match(/^[\d\.]+$/)&&(c=ts_sort_numeric);SORT_COLUMN_INDEX=d;d=[];g=[];for(var f=null!=getSortBottomRow(e)?getSortBottomRow(e)+1:e.rows.length;f<e.rows.length;++f)g[g.length]=e.rows[f];for(f=getHeaderRow(e)+1;f<e.rows.length;++f)d[d.length]=e.rows[f];d.sort(c);"down"==b.getAttribute("sortdir")?(c='<img border="0" src="'+image_path+image_up+'" alt="&#x2191;"/>',d.reverse(),b.setAttribute("sortdir","up")):(c='<img border="0" src="'+image_path+image_down+'" alt="&#x2193;"/>',
b.setAttribute("sortdir","down"));for(f=0;f<d.length;++f)(!d[f].className||d[f].className&&-1==d[f].className.indexOf("sortBottom"))&&e.tBodies[0].appendChild(d[f]);for(f=0;f<d.length;f++)d[f].className&&-1!=d[f].className.indexOf("sortBottom")&&e.tBodies[0].appendChild(d[f]);for(f=0;f<g.length;++f)e.tBodies[0].appendChild(g[f]);g=document.getElementsByTagName("span");for(d=0;d<g.length;++d)"sortarrow"==g[d].className&&getParent(g[d],"table")==getParent(a,"table")&&(g[d].innerHTML='<img border="0" src="'+
image_path+image_none+'" alt="&#x21F5;"/>');b.innerHTML=c;alternate(e)}}
function Filter(a){getFilters(a);for(var b=document.getElementById(a),c=[],d=getCellsNb(a),e=0;e<SearchFlt.length;++e)c.push(document.getElementById(SearchFlt[e]).value.toLowerCase());var g=getStartRow(a);a=b.getElementsByTagName("tr");for(e=null!=getSortBottomRow(b)?getSortBottomRow(b):b.rows.length;g<a.length;++g){var f=!0;"none"==a[g].style.display&&(a[g].style.display="");var n=getChildElms(a[g]).childNodes,q=n.length;if(q==d){for(var p=[],h=[],k=0;k<q;k++){var l=getCellText(n[k]).toLowerCase();
p.push(l);if(""!=c[k]){var m=parseFloat(l);/<=/.test(c[k])&&!isNaN(m)?m<=parseFloat(c[k].replace(/<=/,""))?h[k]=3:h[k]=1:/>=/.test(c[k])&&!isNaN(m)?m>=parseFloat(c[k].replace(/>=/,""))?h[k]=3:h[k]=1:/</.test(c[k])&&!isNaN(m)?m<parseFloat(c[k].replace(/</,""))?h[k]=3:h[k]=1:/>/.test(c[k])&&!isNaN(m)?m>parseFloat(c[k].replace(/>/,""))?h[k]=3:h[k]=1:h[k]=l.split(c[k]).length}}for(n=0;n<d;n++)""!=c[n]&&2>h[n]&&(f=!1)}a[g].style.display=0==f&&g<e?"none":""}alternate(b)}
function getHeaderRow(a){for(var b=0;b<a.rows.length-1;++b)if(-1<a.rows[b].className.indexOf("sortHeader"))return b;return 0}function getSortBottomRow(a){for(var b=0;b<a.rows.length;++b)if(-1<a.rows[b].className.indexOf("sortBottom"))return b;return null}
function ts_getInnerText(a){if("string"==typeof a)return a;if("undefined"==typeof a)return"";if("object"==typeof a&&"img"==a.tagName.toLowerCase())return a.alt;if(a.innerText)return a.innerText;var b="";a=a.childNodes;for(var c=a.length,d=0;d<c;d++)switch(a[d].nodeType){case 1:b+=ts_getInnerText(a[d]);break;case 3:b+=a[d].nodeValue}return b}
function ts_makeSortable(a){var b;a.rows&&0<a.rows.length&&(b=a.rows[getHeaderRow(a)]);if(b){for(var c=0;c<b.cells.length;++c){var d=b.cells[c],e=ts_getInnerText(d);"unsortable"!=d.className&&-1==d.className.indexOf("unsortable")&&(d.innerHTML='<a href="#" class="sortHeader" onclick="ts_resortTable(this);return false;">'+e+'<span class="sortarrow"><img border="0" src="'+image_path+image_none+'" alt="&#x21F5;"/></span></a>')}alternate(a)}}
function alternate(a){if(-1<a.className.indexOf("doOddEven"))for(var b=1,c=null!=getSortBottomRow(a)?getSortBottomRow(a):a.rows.length,d=a.getElementsByTagName("tbody"),e=0;e<d.length;e++)for(var g=d[e].getElementsByTagName("tr"),f=getHeaderRow(a)+1;f<c;++f)""==g[f].style.display&&(b++,swapOddEven(g[f],b))}function getParent(a,b){return null==a?null:1==a.nodeType&&a.tagName.toLowerCase()==b.toLowerCase()?a:getParent(a.parentNode,b)}
function addEvent(a,b,c,d){if(a.addEventListener)return a.addEventListener(b,c,d),!0;if(a.attachEvent)return a.attachEvent("on"+b,c);alert("Handler could not be removed")}function replace(a,b,c){var d=a.indexOf(b);if(-1==d)return a;var e=""+(a.substring(0,d)+c);d+b.length<a.length&&(e+=replace(a.substring(d+b.length,a.length),b,c));return e}
function setFilterGrid(a){var b=document.getElementById(a);if(null!=b&&"table"==b.nodeName.toLowerCase()){TblId.push(a);if(1<arguments.length)for(b=0;b<arguments.length;b++)switch((typeof arguments[b]).toLowerCase()){case "number":var c=arguments[b];break;case "object":var d=arguments[b]}void 0==c?StartRow.push(2):StartRow.push(c+2);c=getCellsNb(a,c);AddRow(a,c,d)}}
function AddRow(a,b,c){var d=document.getElementById(a),e=d.insertRow(0);d=d.rows[getHeaderRow(d)];var g,f,n,q,p;void 0!=c&&0==c.btn?f=!1:f=!0;void 0!=c&&void 0!=c.btn_text?n=c.btn_text:n="Filter";void 0!=c&&0==c.enter_key?q=!1:q=!0;void 0!=c&&c.mod_filter_fn?p=!0:p=!1;p&&(ModFnId.push(a),ModFn.push(c.mod_filter_fn));for(var h=0;h<b;++h){var k=e.insertCell(h),l=d.cells[h];h==b-1&&1==f?g="flt_s":g="flt";if(void 0!=c&&void 0!=c["col_"+h]&&"none"!=c["col_"+h]||-1!=l.className.indexOf("selectFilter"))-1!=
l.className.indexOf("selectFilter")&&(l=document.createElement("select"),l.setAttribute("id","flt"+h+"_"+a),l.className=g,k.appendChild(l),PopulateOptions(a,h,b),q&&(l.onkeypress=DetectKey));else{var m=document.createElement("input");m.setAttribute("id","flt"+h+"_"+a);m.setAttribute("size","5");-1==l.className.indexOf("noFilter")?m.setAttribute("type","text"):m.setAttribute("type","hidden");m.className=g;k.appendChild(m);q&&(m.onkeypress=DetectKey)}h==b-1&&1==f&&(l=document.createElement("input"),
l.setAttribute("id","btn"+h+"_"+a),l.setAttribute("type","button"),l.setAttribute("value",n),l.className="btnflt",k.appendChild(l),p?l.onclick=c.mod_filter_fn:l.onclick=function(){Filter(a)})}}
function PopulateOptions(a,b,c){var d=document.getElementById(a),e=getStartRow(a);d=d.getElementsByTagName("tr");for(var g=[],f=0;e<d.length;++e){var n=getChildElms(d[e]).childNodes,q=n.length;if(q==c)for(var p=0;p<q;++p)if(b==p){var h=getCellText(n[p]);-1==g.toString().toUpperCase().search(h.toUpperCase())&&(f++,g.push(h),h=new Option(h,h,!1,!1),document.getElementById("flt"+b+"_"+a).options[f]=h)}}}
function getCellsNb(a,b){a=document.getElementById(a);b=void 0==b?a.getElementsByTagName("tr")[0]:a.getElementsByTagName("tr")[b];return getChildElms(b).childNodes.length}function getFilters(a){SearchFlt=[];a=document.getElementById(a).getElementsByTagName("tr")[0].childNodes;for(var b=0;b<a.length;++b)SearchFlt.push(a[b].firstChild.getAttribute("id"))}function getStartRow(a){var b,c;for(c in TblId)TblId[c]==a&&(b=StartRow[c]);return b}
function getChildElms(a){if(1==a.nodeType){for(var b=a.childNodes,c=0;c<b.length;++c){var d=b[c];3==d.nodeType&&a.removeChild(d)}return a}}function getCellText(a){var b="";a=a.childNodes;for(var c=0;c<a.length;++c){var d=a[c];b=3==d.nodeType?b+d.data:b+getCellText(d)}return b}
function DetectKey(a){if((a=a?a:window.event?window.event:null)&&"13"==(a.charCode?a.charCode:a.keyCode?a.keyCode:a.which?a.which:0)){var b;a=this.getAttribute("id");var c=this.getAttribute("id").split("_")[0];a=a.substring(c.length+1,a.length);for(var d in ModFn)ModFnId[d]==a?b=!0:b=!1;b?ModFn[d].call():Filter(a)}}
function swapOddEven(a,b){0==b%2?-1<a.className.indexOf("odd")?a.className=replace(a.className,"odd","even"):a.className=-1<a.className.indexOf("even")?a.className:a.className+" even":(-1<a.className.indexOf("even")&&(a.className=replace(a.className,"even","odd")),a.className=-1<a.className.indexOf("odd")?a.className:a.className+" odd")}
function ts_sort_date(a,b){a=ts_getInnerText(a.cells[SORT_COLUMN_INDEX]);b=ts_getInnerText(b.cells[SORT_COLUMN_INDEX]);if(10==a.length)a=a.substr(6,4)+a.substr(3,2)+a.substr(0,2);else{var c=a.substr(6,2);c=50>parseInt(c)?"20"+c:"19"+c;a=c+a.substr(3,2)+a.substr(0,2)}10==b.length?b=b.substr(6,4)+b.substr(3,2)+b.substr(0,2):(c=b.substr(6,2),c=50>parseInt(c)?"20"+c:"19"+c,b=c+b.substr(3,2)+b.substr(0,2));return a==b?0:a<b?-1:1}
function ts_sort_currency(a,b){a=ts_getInnerText(a.cells[SORT_COLUMN_INDEX]).replace(/[^0-9.]/g,"");b=ts_getInnerText(b.cells[SORT_COLUMN_INDEX]).replace(/[^0-9.]/g,"");return isNaN(parseFloat(a)-parseFloat(b))?-1:parseFloat(a)-parseFloat(b)}function ts_sort_numeric(a,b){a=parseFloat(ts_getInnerText(a.cells[SORT_COLUMN_INDEX]));b=parseFloat(ts_getInnerText(b.cells[SORT_COLUMN_INDEX]));isNaN(a)&&(a=0);isNaN(b)&&(b=0);return a-b}
function ts_sort_caseinsensitive(a,b){a=ts_getInnerText(a.cells[SORT_COLUMN_INDEX]).toLowerCase();b=ts_getInnerText(b.cells[SORT_COLUMN_INDEX]).toLowerCase();return a==b?0:a<b?-1:1}function ts_sort_default(a,b){a=ts_getInnerText(a.cells[SORT_COLUMN_INDEX]);b=ts_getInnerText(b.cells[SORT_COLUMN_INDEX]);return a==b?0:a<b?-1:1}
;
//# sourceMappingURL=tablefilterNsort.min.js.map
