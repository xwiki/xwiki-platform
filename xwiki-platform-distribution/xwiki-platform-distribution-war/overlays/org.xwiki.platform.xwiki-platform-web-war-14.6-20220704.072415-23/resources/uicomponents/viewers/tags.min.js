'use strict';var XWiki=function(c){function g(){return new h.Tags}var h=c.viewers=c.viewers||{};h.Tags=Class.create({initialize:function(){$$(".doc-tags .tag-delete").each(this.ajaxTagDelete);$$(".doc-tags .tag-add a").each(this.createTagAddForm.bind(this));0<$$(".doc-tags .tag-add-form").length&&this.ajaxifyForm($$(".doc-tags .tag-add-form")[0])},ajaxTagDelete:function(a){a.observe("click",function(e){e&&e.stop();a.disabled||new Ajax.Request(a.readAttribute("href").replace(/&xredirect=.+$/,"&ajax=1"),
{onCreate:function(){a.disabled=!0;a.notification=new c.widgets.Notification("$services.localization.render('core.tags.deleting')","inprogress")},onSuccess:function(){a.up(".tag-wrapper").remove()},onFailure:function(b){new c.widgets.Notification(b.responseText||"Server not responding","error")},on0:function(b){b.request.options.onFailure(b)},onComplete:function(){a.disabled=!1;a.notification.hide()}})}.bindAsEventListener())},createTagAddForm:function(a){a.observe("click",function(e){e&&e.stop();
a._x_form?(Element.replace(a,a._x_form),a._x_form.down("input[type=text]").focus()):a.disabled||new Ajax.Request(a.readAttribute("href").replace(/#.+$/,"&ajax=1&xpage=documentTags"),{onCreate:function(){a.disabled=!0;a.notification=new c.widgets.Notification("$services.localization.render('core.tags.fetchform')","inprogress")},onSuccess:function(b){var d=a.up();a.remove();d.update(b.responseText);a._x_form=d.firstDescendant();a._x_form._x_activator=a;a._x_form.down("input[type=text]").focus();this.ajaxifyForm(a._x_form)}.bind(this),
onFailure:function(b){new c.widgets.Notification(b.responseText||"Server not responding","error")},on0:function(b){b.request.options.onFailure(b)},onComplete:function(){a.disabled=!1;a.notification.hide()}})}.bindAsEventListener(this))},ajaxifyForm:function(a){a.setAttribute("autocomplete","off");a.down("input[type=text]").setAttribute("autocomplete","off");a.down("input[type=text]").setAttribute("autocomplete","off");a.observe("submit",function(b){b.stop();a.down("input[type=text]").focus();""!=
a.tag.value&&new Ajax.Request(a.action.replace(/&xredirect=.+$/,"&ajax=1&tag=")+encodeURIComponent(a.tag.value),{onCreate:function(){a.disable();a.notification=new c.widgets.Notification("$services.localization.render('core.tags.adding')","inprogress")},onSuccess:function(d){var f=new Element("span");f.insert(d.responseText+" ");for(f.select(".tag-delete").each(this.ajaxTagDelete);0<f.childNodes.length;)a.up(".tag-add").insert({before:f.firstChild}),a.up(".tag-add").insert({before:" "}),f.removeChild(f.firstChild);
a.reset()}.bind(this),onFailure:function(d){new c.widgets.Notification(d.responseText||"Server not responding","error")},onComplete:function(){a.enable();a.notification.hide()},on0:function(d){d.request.options.onFailure(d)}})}.bindAsEventListener(this));a.observe("reset",function(b){Element.replace(a,a._x_activator)}.bindAsEventListener(this));var e=new Element("input",{type:"reset",value:a.down(".button-add-tag-cancel").innerHTML,"class":"button secondary"});a.down(".button-add-tag-cancel").replace(e);
new c.widgets.Suggest(a.down("input[type=text]"),{script:"${xwiki.getURL('Main.WebHome', 'view', 'xpage=suggest&classname=XWiki.TagClass&fieldname=tags&firCol=-&secCol=-')}&",varname:"input",seps:"${xwiki.getDocument('XWiki.TagClass').xWikiClass.tags.getProperty('separators').value}",shownoresults:!1,icon:"${xwiki.getSkinFile('icons/silk/tag_yellow.png')}"})}});c.domIsLoaded&&g()||document.observe("xwiki:dom:loaded",g);return c}(XWiki||{});

//# sourceMappingURL=tags.min.js.map
