{"version":3,"file":"index.es.js","sources":["../src/defaultModelReferenceHandler.ts","../src/defaultModelReferenceHandlerProvider.ts","../src/defaultModelReferenceParserProvider.ts","../src/defaultModelReferenceSerializerProvider.ts","../src/componentInit.ts"],"sourcesContent":["/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport {\n  AttachmentReference,\n  DocumentReference,\n  EntityType,\n} from \"@xwiki/platform-model-api\";\nimport { injectable } from \"inversify\";\nimport type { ModelReferenceHandler } from \"./modelReferenceHandler\";\nimport type {\n  EntityReference,\n  SpaceReference,\n  WikiReference,\n} from \"@xwiki/platform-model-api\";\n\n/**\n * Default implementation for {@link ModelReferenceHandler}.\n *\n * @since 0.13\n * @beta\n */\n@injectable()\nclass DefaultModelReferenceHandler implements ModelReferenceHandler {\n  createDocumentReference(\n    name: string,\n    space: SpaceReference,\n  ): DocumentReference {\n    return new DocumentReference(name, space);\n  }\n\n  getTitle(reference: EntityReference): string {\n    switch (reference.type) {\n      case EntityType.WIKI:\n        return (reference as WikiReference).name;\n      case EntityType.SPACE:\n        return [...(reference as SpaceReference).names].pop()!;\n      case EntityType.DOCUMENT: {\n        return (reference as DocumentReference).name;\n      }\n      case EntityType.ATTACHMENT:\n        return (reference as AttachmentReference).name;\n    }\n    return \"\";\n  }\n}\n\nexport { DefaultModelReferenceHandler };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { inject, injectable } from \"inversify\";\nimport type { ModelReferenceHandler } from \"./modelReferenceHandler\";\nimport type { ModelReferenceHandlerProvider } from \"./modelReferenceHandlerProvider\";\nimport type { CristalApp } from \"@xwiki/platform-api\";\n\n/**\n * Default implementation for {@link ModelReferenceHandlerProvider}.\n * Will provide an instance of\n * {@link ./defaultModelReferenceHandler#DefaultModelReferenceHandler} as a\n * fallback if no better fit was registered.\n *\n * @since 0.13\n * @beta\n */\n@injectable()\nclass DefaultModelReferenceHandlerProvider\n  implements ModelReferenceHandlerProvider\n{\n  constructor(@inject(\"CristalApp\") private cristalApp: CristalApp) {}\n\n  get(type?: string): ModelReferenceHandler | undefined {\n    const container = this.cristalApp.getContainer();\n    const resolvedType = type || this.cristalApp.getWikiConfig().getType();\n    // If there is no specific ModelReferenceHandler registered for the\n    // requested type, we return an instance of DefaultModelReferenceHandler\n    // (which should be the only unnamed one).\n    if (container.isBound(\"ModelReferenceHandler\", { name: resolvedType })) {\n      return container.get(\"ModelReferenceHandler\", { name: resolvedType });\n    } else {\n      return container.get(\"ModelReferenceHandler\");\n    }\n  }\n}\n\nexport { DefaultModelReferenceHandlerProvider };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { inject, injectable } from \"inversify\";\nimport type { ModelReferenceParser } from \"./modelReferenceParser\";\nimport type { ModelReferenceParserProvider } from \"./modelReferenceParserProvider\";\nimport type { CristalApp } from \"@xwiki/platform-api\";\n\n/**\n * @since 0.12\n * @beta\n */\n@injectable()\nclass DefaultModelReferenceParserProvider\n  implements ModelReferenceParserProvider\n{\n  constructor(@inject(\"CristalApp\") private readonly cristalApp: CristalApp) {}\n\n  get(type?: string): ModelReferenceParser | undefined {\n    const resolvedType = type || this.cristalApp.getWikiConfig().getType();\n    try {\n      return this.cristalApp\n        .getContainer()\n        .get(\"ModelReferenceParser\", { name: resolvedType });\n    } catch (e) {\n      this.cristalApp\n        .getLogger(\"model-reference.api\")\n        .warn(\n          `Couldn't resolve ModelReferenceParser for type=[${resolvedType}]`,\n          e,\n        );\n      return undefined;\n    }\n  }\n}\n\nexport { DefaultModelReferenceParserProvider };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { inject, injectable } from \"inversify\";\nimport type { ModelReferenceSerializer } from \"./modelReferenceSerializer\";\nimport type { ModelReferenceSerializerProvider } from \"./modelReferenceSerializerProvider\";\nimport type { CristalApp } from \"@xwiki/platform-api\";\n\n/**\n * @since 0.12\n * @beta\n */\n@injectable()\nclass DefaultModelReferenceSerializerProvider\n  implements ModelReferenceSerializerProvider\n{\n  constructor(@inject(\"CristalApp\") private readonly cristalApp: CristalApp) {}\n\n  get(type?: string): ModelReferenceSerializer | undefined {\n    const resolvedType = type || this.cristalApp.getWikiConfig().getType();\n    try {\n      return this.cristalApp\n        .getContainer()\n        .get(\"ModelReferenceSerializer\", { name: resolvedType });\n    } catch (e) {\n      this.cristalApp\n        .getLogger(\"model-reference.api\")\n        .warn(\n          `Couldn't resolve ModelReferenceSerializer for type=[${resolvedType}]`,\n          e,\n        );\n      return undefined;\n    }\n  }\n}\n\nexport { DefaultModelReferenceSerializerProvider };\n","/**\n * See the LICENSE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n\nimport { DefaultModelReferenceHandler } from \"./defaultModelReferenceHandler\";\nimport { DefaultModelReferenceHandlerProvider } from \"./defaultModelReferenceHandlerProvider\";\nimport { DefaultModelReferenceParserProvider } from \"./defaultModelReferenceParserProvider\";\nimport { DefaultModelReferenceSerializerProvider } from \"./defaultModelReferenceSerializerProvider\";\nimport type { ModelReferenceHandler } from \"./modelReferenceHandler\";\nimport type { ModelReferenceHandlerProvider } from \"./modelReferenceHandlerProvider\";\nimport type { ModelReferenceParserProvider } from \"./modelReferenceParserProvider\";\nimport type { ModelReferenceSerializerProvider } from \"./modelReferenceSerializerProvider\";\nimport type { Container } from \"inversify\";\n\n/**\n * @beta\n */\nclass ComponentInit {\n  constructor(container: Container) {\n    container\n      .bind<ModelReferenceHandler>(\"ModelReferenceHandler\")\n      .to(DefaultModelReferenceHandler)\n      .inSingletonScope()\n      .whenDefault();\n    container\n      .bind<ModelReferenceHandlerProvider>(\"ModelReferenceHandlerProvider\")\n      .to(DefaultModelReferenceHandlerProvider)\n      .inSingletonScope();\n    container\n      .bind<ModelReferenceParserProvider>(\"ModelReferenceParserProvider\")\n      .to(DefaultModelReferenceParserProvider)\n      .inSingletonScope();\n    container\n      .bind<ModelReferenceSerializerProvider>(\n        \"ModelReferenceSerializerProvider\",\n      )\n      .to(DefaultModelReferenceSerializerProvider)\n      .inSingletonScope();\n  }\n}\n\nexport { ComponentInit };\n"],"names":["DefaultModelReferenceHandler","name","space","DocumentReference","reference","EntityType","__decorateClass","injectable","DefaultModelReferenceHandlerProvider","cristalApp","type","container","resolvedType","__decorateParam","DefaultModelReferenceParserProvider","e","DefaultModelReferenceSerializerProvider","ComponentInit"],"mappings":";;;;;;;AAwCA,IAAMA,IAAN,MAAoE;AAAA,EAClE,wBACEC,GACAC,GACmB;AACnB,WAAO,IAAIC,EAAkBF,GAAMC,CAAK;AAAA,EAC1C;AAAA,EAEA,SAASE,GAAoC;AAC3C,YAAQA,EAAU,MAAA;AAAA,MAChB,KAAKC,EAAW;AACd,eAAQD,EAA4B;AAAA,MACtC,KAAKC,EAAW;AACd,eAAO,CAAC,GAAID,EAA6B,KAAK,EAAE,IAAA;AAAA,MAClD,KAAKC,EAAW;AACd,eAAQD,EAAgC;AAAA,MAE1C,KAAKC,EAAW;AACd,eAAQD,EAAkC;AAAA,IAAA;AAE9C,WAAO;AAAA,EACT;AACF;AAtBMJ,IAANM,EAAA;AAAA,EADCC,EAAA;AAAW,GACNP,CAAA;;;;;;ACLN,IAAMQ,IAAN,MAEA;AAAA,EACE,YAA0CC,GAAwB;AAAxB,SAAA,aAAAA;AAAA,EAAyB;AAAA,EAEnE,IAAIC,GAAkD;AACpD,UAAMC,IAAY,KAAK,WAAW,aAAA,GAC5BC,IAAeF,KAAQ,KAAK,WAAW,cAAA,EAAgB,QAAA;AAI7D,WAAIC,EAAU,QAAQ,yBAAyB,EAAE,MAAMC,EAAA,CAAc,IAC5DD,EAAU,IAAI,yBAAyB,EAAE,MAAMC,GAAc,IAE7DD,EAAU,IAAI,uBAAuB;AAAA,EAEhD;AACF;AAjBMH,IAANF,EAAA;AAAA,EADCC,EAAA;AAAA,EAIcM,OAAO,YAAY,CAAA;AAAA,GAH5BL,CAAA;;;;;;ACLN,IAAMM,IAAN,MAEA;AAAA,EACE,YAAmDL,GAAwB;AAAxB,SAAA,aAAAA;AAAA,EAAyB;AAAA,EAE5E,IAAIC,GAAiD;AACnD,UAAME,IAAeF,KAAQ,KAAK,WAAW,cAAA,EAAgB,QAAA;AAC7D,QAAI;AACF,aAAO,KAAK,WACT,aAAA,EACA,IAAI,wBAAwB,EAAE,MAAME,GAAc;AAAA,IACvD,SAASG,GAAG;AACV,WAAK,WACF,UAAU,qBAAqB,EAC/B;AAAA,QACC,mDAAmDH,CAAY;AAAA,QAC/DG;AAAA,MAAA;AAEJ;AAAA,IACF;AAAA,EACF;AACF;AArBMD,IAANR,EAAA;AAAA,EADCC,EAAA;AAAA,EAIcM,OAAO,YAAY,CAAA;AAAA,GAH5BC,CAAA;;;;;;ACAN,IAAME,IAAN,MAEA;AAAA,EACE,YAAmDP,GAAwB;AAAxB,SAAA,aAAAA;AAAA,EAAyB;AAAA,EAE5E,IAAIC,GAAqD;AACvD,UAAME,IAAeF,KAAQ,KAAK,WAAW,cAAA,EAAgB,QAAA;AAC7D,QAAI;AACF,aAAO,KAAK,WACT,aAAA,EACA,IAAI,4BAA4B,EAAE,MAAME,GAAc;AAAA,IAC3D,SAASG,GAAG;AACV,WAAK,WACF,UAAU,qBAAqB,EAC/B;AAAA,QACC,uDAAuDH,CAAY;AAAA,QACnEG;AAAA,MAAA;AAEJ;AAAA,IACF;AAAA,EACF;AACF;AArBMC,IAANV,EAAA;AAAA,EADCC,EAAA;AAAA,EAIcM,OAAO,YAAY,CAAA;AAAA,GAH5BG,CAAA;ACGN,MAAMC,EAAc;AAAA,EAClB,YAAYN,GAAsB;AAChC,IAAAA,EACG,KAA4B,uBAAuB,EACnD,GAAGX,CAA4B,EAC/B,iBAAA,EACA,YAAA,GACHW,EACG,KAAoC,+BAA+B,EACnE,GAAGH,CAAoC,EACvC,iBAAA,GACHG,EACG,KAAmC,8BAA8B,EACjE,GAAGG,CAAmC,EACtC,iBAAA,GACHH,EACG;AAAA,MACC;AAAA,IAAA,EAED,GAAGK,CAAuC,EAC1C,iBAAA;AAAA,EACL;AACF;"}